{"version":3,"sources":["../../../.nvm/versions/node/v8.11.1/lib/node_modules/parcel/node_modules/process/browser.js","../node_modules/waaclock/lib/WAAClock.js","../node_modules/waaclock/index.js","../lib/Pulse.js","../lib/Band.js","../node_modules/tonal-note/build/es6.js","../node_modules/tonal-array/build/es6.js","../node_modules/tonal-interval/build/es6.js","../node_modules/tonal-distance/build/es6.js","../node_modules/tonal-pcset/build/es6.js","../node_modules/tonal-dictionary/build/es6.js","../node_modules/tonal-scale/build/es6.js","../node_modules/tonal-chord/build/es6.js","../node_modules/tonal/index.js","../lib/instruments/Instrument.js","../lib/instruments/Synthesizer.js","../lib/util.js","../lib/musicians/Musician.js","../lib/grooves/swing.js","../lib/musicians/Pianist.js","../lib/musicians/Drummer.js","../lib/musicians/Bassist.js","../lib/instruments/Sampler.js","../lib/instruments/Kick.js","../lib/instruments/Snare.js","../lib/instruments/PlasticDrums.js","../lib/Metronome.js","../lib/Trio.js","../lib/index.js","../src/RealParser.ts","samples/piano.js","samples/drumset.js","../node_modules/ireal-reader/unscramble.js","../node_modules/ireal-reader/Music.js","../node_modules/ireal-reader/Song.js","../node_modules/ireal-reader/Playlist.js","../node_modules/ireal-reader/index.js","../src/instruments/Instrument.ts","../src/instruments/Synthesizer.ts","../src/util.ts","../src/grooves/swing.ts","../src/grooves/funk.ts","demo.ts"],"names":["process","module","exports","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","Error","defaultClearTimeout","setTimeout","e","clearTimeout","runTimeout","fun","call","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","length","concat","drainQueue","timeout","len","run","nextTick","args","Array","arguments","i","push","Item","array","prototype","apply","title","browser","env","argv","version","versions","noop","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","name","binding","cwd","chdir","dir","umask","__importDefault","mod","__esModule","Object","defineProperty","value","waaclock_1","require","Pulse","props","defaults","bpm","cycle","delay","events","assign","context","AudioContext","clock","default","toleranceEarly","toleranceLate","getMeasureLength","beatsPerMeasure","arrayPulse","children","path","start","callback","deadline","_this","isArray","item_1","pulse","callbackAtTime","currentTime","event","childLength","map","el","tickArray","l","Promise","resolve","reject","tick","criticalEvents","console","warn","stop","changeTempo","newTempo","factor","filter","timeStretch","Pulse_1","Band","_a","_b","musicians","division","transpose","style","ready","all","resume","m","then","comp","measures","settings","play","forEach","musician","tokenize","fromMidi","NAMES","split","names","accTypes","slice","n","acc","indexOf","SHARPS","FLATS","REGEX","str","exec","toUpperCase","replace","NO_NOTE","freeze","pc","step","alt","oct","octStr","chroma","midi","freq","SEMI","properties","tokens","letter","p","charCodeAt","midiToFreq","memo","fn","cache","note","tuning","Math","pow","L2","log","L440","freqToMidi","v","round","LETTERS","stepToLetter","fillStr","s","join","numToStr","num","op","altToAcc","from","fromProps","baseNote","ref","build","sharps","pcs","o","floor","simplify","sameAcc","useSharps","enharmonic","range","rotate","sort","unique","ascR","b","a","descR","times","arr","compact","height","src","shuffle","rnd","random","t","permutations","reduce","perm","pos","newPerm","splice","IVL_TNL","IVL_STR","RegExp","SIZES","TYPES","CLASSES","types","NO_IVL","q","type","simple","semitones","abs","qToAlt","test","altToQ","numToStep","ic","ivl","undefined","d","invert","IN","IQ","fromSemitones","c","trFifths","fifths","transposeBy","addIntervals","add","subtract","interval","FIFTHS","fOcts","f","FIFTH_OCTS","encode","STEPS","unaltered","decode","encoder","encodeNote","noteProps","encodeIvl","iprops","tr","to","isDescending","decodeIvl","ivl1","ivl2","i1","i2","chromas","modes","isChroma","intervals","isEqual","isSubsetOf","isSupersetOf","includes","chr","pcsetNum","set","parseInt","clen","toString","normalize","binary","_","r","IVLS","s1","s2","notes","dictionary","raw","keys","data","index","ivls","key","alias","allKeys","dict","combine","scale","sdata","chord","cdata","pcset","exists","NO_SCALE","setnum","memoize","nameOrTonic","tonic","substring","modeNames","tonics","x","chords","inScale","toScale","supersets","isSuperset","subsets","isSubset","NO_CHORD","NUM_TYPES","Note","Interval","Distance","Dictionary","Scale","Chord","PcSet","util_1","Instrument","gain","mix","onPlay","onStop","midiOffset","init","destination","playNotes","playKeys","getMidi","__extends","extendStatics","setPrototypeOf","__proto__","hasOwnProperty","__","constructor","create","Instrument_1","tonal_1","Synthesizer","_super","duration","attack","decay","sustain","release","getVoice","frequency","oscNode","createOscillator","gainNode","createGain","connect","lowestGain","time","voice","adsr","Synthesizer_1","randomNumber","arraySum","randomElement","weighted","total","w","find","getTonalChord","offset","getPath","traveled","min","resolveChords","pattern","divisions","fraction","hasOff","offbeatReducer","bar","last","invertInterval","smallestInterval","inversion","minInterval","preferRightMovement","intervalMatrix","randomSynth","allowed","gains","sine","triangle","square","sawtooth","wave","param","linearRampToValueAtTime","setTargetAtTime","max","Musician","instrument","swing","measure","bass","crash","fill","ride","hihat","tonal_2","Musician_1","swing_1","Pianist","playedNotes","playedPatterns","playedChords","intelligentVoicings","groove","noTonic","rollFactor","measureLength","exact","playChord","humanFactor","arpeggio","ceil","getLastVoicing","getVoicing","scorenotes","before","near","smallest","root","Drummer","kick","snare","patterns","Bassist","playBass","getStep","octave","steps","Sampler","options","buffers","samples","sources","loadSources","getBuffer","buffer","fetch","res","arrayBuffer","decodeAudioData","decodedData","getSource","source","createBufferSource","getSources","hasLoaded","error","loadSource","allLoaded","playSounds","sounds","sound","playSource","Kick","setup","osc","trigger","setValueAtTime","exponentialRampToValueAtTime","Snare","noiseBuffer","bufferSize","sampleRate","createBuffer","output","getChannelData","noise","noiseFilter","createBiquadFilter","noiseEnvelope","oscEnvelope","Kick_1","Snare_1","PlasticDrums","missing","Metronome","synth","count","bars","Band_1","Pianist_1","Bassist_1","Drummer_1","PlasticDrums_1","Metronome_1","Trio","piano","drums","setupMix","instruments","setupInstruments","pianist","bassist","drummer","metronome","__importStar","result","k","Sampler_1","Trio_1","util","C1","Db1","D1","Eb1","E1","F1","Gb1","G1","Ab1","A1","Bb1","B1","C2","Db2","D2","Eb2","E2","F2","Gb2","G2","Ab2","A2","Bb2","B2","C3","Db3","D3","Eb3","E3","F3","Gb3","G3","Ab3","A3","Bb3","B3","C4","Db4","D4","Eb4","E4","F4","Gb4","G4","Ab4","A4","Bb4","B4","C5","Db5","D5","Eb5","E5","F5","Gb5","G5","Ab5","A5","Bb5","B5","C6","Db6","D6","Eb6","E6","F6","Gb6","G6","Ab6","A6","Bb6","B6","C7","Db7","D7","Eb7","E7","F7","Gb7","G7","Ab7","A7","Bb7","B7","h","drumset"],"mappings":"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CA3C,QAAQoD,mBAAR,GAA8BT,IAA9B;;AAEA3C,QAAQqD,SAAR,GAAoB,UAAUC,IAAV,EAAgB;AAAE,WAAO,EAAP;AAAW,CAAjD;;AAEAtD,QAAQuD,OAAR,GAAkB,UAAUD,IAAV,EAAgB;AAC9B,UAAM,IAAIhD,KAAJ,CAAU,kCAAV,CAAN;AACH,CAFD;;AAIAN,QAAQwD,GAAR,GAAc,YAAY;AAAE,WAAO,GAAP;AAAY,CAAxC;AACAxD,QAAQyD,KAAR,GAAgB,UAAUC,GAAV,EAAe;AAC3B,UAAM,IAAIpD,KAAJ,CAAU,gCAAV,CAAN;AACH,CAFD;AAGAN,QAAQ2D,KAAR,GAAgB,YAAW;AAAE,WAAO,CAAP;AAAW,CAAxC;;;ACvLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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C,aA5EiB,EA6EjBC,YA7EiB,EA8EjBC,YA9EiB,EA+EjBC,aA/EiB,EAgFjBC,YAhFiB,EAiFjBC,aAjFiB,EAkFjBC,YAlFiB,EAmFjBC,aAnFiB,EAoFjBC,YApFiB,CAAd;;;;;;;;;;;;;;;;;;;ACpFP;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEO,IAAMpK,sBAAO6E,cAAb;AACA,IAAM5E,wBAAQlR,eAAd;AACA,IAAMuP,wBAAQ+L,eAAd;AACA,IAAMhM,sBAAOrI,cAAb;AACA,IAAMmI,wBAAQjL,eAAd;AACA,IAAMoX,4BAAU,CAACtK,IAAD,EAAOC,KAAP,EAAc3B,KAAd,EAAqBD,IAArB,EAA2BF,KAA3B,CAAhB;;ACZP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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","file":"demo.d88735c5.map","sourceRoot":"..","sourcesContent":["// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var isBrowser = (typeof window !== 'undefined')\n\nvar CLOCK_DEFAULTS = {\n  toleranceLate: 0.10,\n  toleranceEarly: 0.001\n}\n\n// ==================== Event ==================== //\nvar Event = function(clock, deadline, func) {\n  this.clock = clock\n  this.func = func\n  this._cleared = false // Flag used to clear an event inside callback\n\n  this.toleranceLate = clock.toleranceLate\n  this.toleranceEarly = clock.toleranceEarly\n  this._latestTime = null\n  this._earliestTime = null\n  this.deadline = null\n  this.repeatTime = null\n\n  this.schedule(deadline)\n}\n\n// Unschedules the event\nEvent.prototype.clear = function() {\n  this.clock._removeEvent(this)\n  this._cleared = true\n  return this\n}\n\n// Sets the event to repeat every `time` seconds.\nEvent.prototype.repeat = function(time) {\n  if (time === 0)\n    throw new Error('delay cannot be 0')\n  this.repeatTime = time\n  if (!this.clock._hasEvent(this))\n    this.schedule(this.deadline + this.repeatTime)\n  return this\n}\n\n// Sets the time tolerance of the event.\n// The event will be executed in the interval `[deadline - early, deadline + late]`\n// If the clock fails to execute the event in time, the event will be dropped.\nEvent.prototype.tolerance = function(values) {\n  if (typeof values.late === 'number')\n    this.toleranceLate = values.late\n  if (typeof values.early === 'number')\n    this.toleranceEarly = values.early\n  this._refreshEarlyLateDates()\n  if (this.clock._hasEvent(this)) {\n    this.clock._removeEvent(this)\n    this.clock._insertEvent(this)\n  }\n  return this\n}\n\n// Returns true if the event is repeated, false otherwise\nEvent.prototype.isRepeated = function() { return this.repeatTime !== null }\n\n// Schedules the event to be ran before `deadline`.\n// If the time is within the event tolerance, we handle the event immediately.\n// If the event was already scheduled at a different time, it is rescheduled.\nEvent.prototype.schedule = function(deadline) {\n  this._cleared = false\n  this.deadline = deadline\n  this._refreshEarlyLateDates()\n\n  if (this.clock.context.currentTime >= this._earliestTime) {\n    this._execute()\n  \n  } else if (this.clock._hasEvent(this)) {\n    this.clock._removeEvent(this)\n    this.clock._insertEvent(this)\n  \n  } else this.clock._insertEvent(this)\n}\n\nEvent.prototype.timeStretch = function(tRef, ratio) {\n  if (this.isRepeated())\n    this.repeatTime = this.repeatTime * ratio\n\n  var deadline = tRef + ratio * (this.deadline - tRef)\n  // If the deadline is too close or past, and the event has a repeat,\n  // we calculate the next repeat possible in the stretched space.\n  if (this.isRepeated()) {\n    while (this.clock.context.currentTime >= deadline - this.toleranceEarly)\n      deadline += this.repeatTime\n  }\n  this.schedule(deadline)\n}\n\n// Executes the event\nEvent.prototype._execute = function() {\n  if (this.clock._started === false) return\n  this.clock._removeEvent(this)\n\n  if (this.clock.context.currentTime < this._latestTime)\n    this.func(this)\n  else {\n    if (this.onexpired) this.onexpired(this)\n    console.warn('event expired')\n  }\n  // In the case `schedule` is called inside `func`, we need to avoid\n  // overrwriting with yet another `schedule`.\n  if (!this.clock._hasEvent(this) && this.isRepeated() && !this._cleared)\n    this.schedule(this.deadline + this.repeatTime) \n}\n\n// Updates cached times\nEvent.prototype._refreshEarlyLateDates = function() {\n  this._latestTime = this.deadline + this.toleranceLate\n  this._earliestTime = this.deadline - this.toleranceEarly\n}\n\n// ==================== WAAClock ==================== //\nvar WAAClock = module.exports = function(context, opts) {\n  var self = this\n  opts = opts || {}\n  this.tickMethod = opts.tickMethod || 'ScriptProcessorNode'\n  this.toleranceEarly = opts.toleranceEarly || CLOCK_DEFAULTS.toleranceEarly\n  this.toleranceLate = opts.toleranceLate || CLOCK_DEFAULTS.toleranceLate\n  this.context = context\n  this._events = []\n  this._started = false\n}\n\n// ---------- Public API ---------- //\n// Schedules `func` to run after `delay` seconds.\nWAAClock.prototype.setTimeout = function(func, delay) {\n  return this._createEvent(func, this._absTime(delay))\n}\n\n// Schedules `func` to run before `deadline`.\nWAAClock.prototype.callbackAtTime = function(func, deadline) {\n  return this._createEvent(func, deadline)\n}\n\n// Stretches `deadline` and `repeat` of all scheduled `events` by `ratio`, keeping\n// their relative distance to `tRef`. In fact this is equivalent to changing the tempo.\nWAAClock.prototype.timeStretch = function(tRef, events, ratio) {\n  events.forEach(function(event) { event.timeStretch(tRef, ratio) })\n  return events\n}\n\n// Removes all scheduled events and starts the clock \nWAAClock.prototype.start = function() {\n  if (this._started === false) {\n    var self = this\n    this._started = true\n    this._events = []\n\n    if (this.tickMethod === 'ScriptProcessorNode') {\n      var bufferSize = 256\n      // We have to keep a reference to the node to avoid garbage collection\n      this._clockNode = this.context.createScriptProcessor(bufferSize, 1, 1)\n      this._clockNode.connect(this.context.destination)\n      this._clockNode.onaudioprocess = function () {\n        process.nextTick(function() { self._tick() })\n      }\n    } else if (this.tickMethod === 'manual') null // _tick is called manually\n\n    else throw new Error('invalid tickMethod ' + this.tickMethod)\n  }\n}\n\n// Stops the clock\nWAAClock.prototype.stop = function() {\n  if (this._started === true) {\n    this._started = false\n    this._clockNode.disconnect()\n  }  \n}\n\n// ---------- Private ---------- //\n\n// This function is ran periodically, and at each tick it executes\n// events for which `currentTime` is included in their tolerance interval.\nWAAClock.prototype._tick = function() {\n  var event = this._events.shift()\n\n  while(event && event._earliestTime <= this.context.currentTime) {\n    event._execute()\n    event = this._events.shift()\n  }\n\n  // Put back the last event\n  if(event) this._events.unshift(event)\n}\n\n// Creates an event and insert it to the list\nWAAClock.prototype._createEvent = function(func, deadline) {\n  return new Event(this, deadline, func)\n}\n\n// Inserts an event to the list\nWAAClock.prototype._insertEvent = function(event) {\n  this._events.splice(this._indexByTime(event._earliestTime), 0, event)\n}\n\n// Removes an event from the list\nWAAClock.prototype._removeEvent = function(event) {\n  var ind = this._events.indexOf(event)\n  if (ind !== -1) this._events.splice(ind, 1)\n}\n\n// Returns true if `event` is in queue, false otherwise\nWAAClock.prototype._hasEvent = function(event) {\n return this._events.indexOf(event) !== -1\n}\n\n// Returns the index of the first event whose deadline is >= to `deadline`\nWAAClock.prototype._indexByTime = function(deadline) {\n  // performs a binary search\n  var low = 0\n    , high = this._events.length\n    , mid\n  while (low < high) {\n    mid = Math.floor((low + high) / 2)\n    if (this._events[mid]._earliestTime < deadline)\n      low = mid + 1\n    else high = mid\n  }\n  return low\n}\n\n// Converts from relative time to absolute time\nWAAClock.prototype._absTime = function(relTime) {\n  return relTime + this.context.currentTime\n}\n\n// Converts from absolute time to relative time \nWAAClock.prototype._relTime = function(absTime) {\n  return absTime - this.context.currentTime\n}","var WAAClock = require('./lib/WAAClock')\n\nmodule.exports = WAAClock\nif (typeof window !== 'undefined') window.WAAClock = WAAClock\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar waaclock_1 = __importDefault(require(\"waaclock\"));\nvar Pulse = /** @class */ (function () {\n    function Pulse(props) {\n        if (props === void 0) { props = {}; }\n        this.defaults = {\n            bpm: 120,\n            cycle: 4,\n            delay: 0\n        };\n        this.events = [];\n        this.props = Object.assign({}, this.defaults, props);\n        this.context = this.props.context || new AudioContext();\n        this.clock = this.props.clock || new waaclock_1.default(this.context, { toleranceEarly: 0.1, toleranceLate: 0.1 });\n    }\n    Pulse.prototype.getMeasureLength = function (bpm, beatsPerMeasure) {\n        if (bpm === void 0) { bpm = this.props.bpm; }\n        if (beatsPerMeasure === void 0) { beatsPerMeasure = this.props.cycle; }\n        return 60 / bpm * beatsPerMeasure;\n    };\n    Pulse.prototype.arrayPulse = function (children, length, path, start, callback, deadline) {\n        var _this = this;\n        if (length === void 0) { length = 1; }\n        if (path === void 0) { path = []; }\n        if (start === void 0) { start = 0; }\n        //TODO: return promise on next one (for chaining)\n        if (!Array.isArray(children)) {\n            if (children === 0) {\n                return 0;\n            }\n            var item_1 = {\n                value: children,\n                length: length,\n                path: path,\n                start: start,\n                pulse: this,\n                cycle: this.props.cycle,\n                timeout: null\n            };\n            start += this.props.delay; // TODO: be able to add delay from arrayPulse fn directly\n            if (this.callbackAtTime) {\n                start += deadline ? deadline : this.context.currentTime;\n                item_1.timeout = this.clock.callbackAtTime(function (event) {\n                    return callback(Object.assign(item_1, { event: event, deadline: event.deadline }));\n                }, start);\n            }\n            else {\n                start += (deadline || this.context.currentTime) - this.context.currentTime;\n                item_1.timeout = this.clock.setTimeout(function (event) {\n                    return callback(Object.assign(item_1, { event: event, deadline: event.deadline }));\n                }, start);\n            }\n            this.events.push(item_1.timeout);\n            return item_1;\n        }\n        var childLength = length / children.length;\n        return {\n            length: length,\n            children: children.map(function (el, i) {\n                return _this.arrayPulse(el, childLength, path.concat([i]), start + i * childLength, callback, deadline);\n            })\n        };\n    };\n    Pulse.prototype.tickArray = function (array, callback, deadline, length) {\n        var _this = this;\n        array.push(1);\n        var l = length || this.getMeasureLength() * array.length;\n        this.start();\n        return new Promise(function (resolve, reject) {\n            _this.arrayPulse(array, l, [], 0, function (tick, start) {\n                if (tick.path[0] === array.length - 1) {\n                    resolve(tick);\n                }\n                else {\n                    callback(tick, start);\n                }\n            }, deadline);\n        });\n    };\n    Pulse.prototype.start = function () {\n        // console.log('start with', this.events.length, 'events');\n        var criticalEvents = 6000;\n        if (this.events.length > criticalEvents) {\n            console.warn('more than ', criticalEvents, 'events received. Consider using less \"times\" to keep the timing precies');\n        }\n        this.clock.start();\n    };\n    Pulse.prototype.stop = function () {\n        this.clock.stop();\n    };\n    Pulse.prototype.changeTempo = function (newTempo, timeout) {\n        var _this = this;\n        if (timeout === void 0) { timeout = 0.2; }\n        var factor = this.props.bpm / newTempo;\n        this.props.bpm = newTempo;\n        var events = this.events.filter(function (e) {\n            return e.deadline - _this.context.currentTime > timeout;\n        });\n        // TODO: stretch durations?!\n        this.clock.timeStretch(this.context.currentTime, events, factor);\n    };\n    return Pulse;\n}());\nexports.Pulse = Pulse;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Pulse_1 = require(\"./Pulse\");\nvar Band = /** @class */ (function () {\n    function Band(_a) {\n        var _b = _a === void 0 ? {} : _a, context = _b.context, musicians = _b.musicians;\n        this.defaults = {\n            cycle: 4,\n            division: 3,\n            transpose: 0,\n            style: 'Medium Swing'\n        };\n        this.context = context || new AudioContext();\n        this.musicians = musicians || [];\n    }\n    Band.prototype.ready = function () {\n        return Promise.all([this.resume()].concat(this.musicians.map(function (m) { return m.ready; })));\n    };\n    Band.prototype.resume = function () {\n        var _this = this;\n        return this.context.resume().then(function () { return _this.context; });\n    };\n    Band.prototype.comp = function (measures, settings) {\n        if (this.pulse) {\n            this.pulse.stop();\n        }\n        settings = Object.assign(this.defaults, settings, { context: this.context });\n        measures = measures.map(function (m) { return !Array.isArray(m) ? [m] : m; });\n        this.play(measures, settings);\n    };\n    Band.prototype.play = function (measures, settings) {\n        var _this = this;\n        this.ready().then(function () {\n            _this.pulse = settings.pulse || new Pulse_1.Pulse(settings);\n            _this.musicians.forEach(function (musician) { return musician.play({ pulse: _this.pulse, measures: measures, settings: settings }); });\n            _this.pulse.start();\n        });\n    };\n    return Band;\n}());\nexports.default = Band;\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-note.svg)](https://www.npmjs.com/package/tonal-note)\n * [![tonal](https://img.shields.io/badge/tonal-note-yellow.svg)](https://www.npmjs.com/browse/keyword/tonal)\n *\n * `tonal-note` is a collection of functions to manipulate musical notes in scientific notation\n *\n * This is part of [tonal](https://www.npmjs.com/package/tonal) music theory library.\n *\n * ## Usage\n *\n * ```js\n * import * as Note from \"tonal-note\"\n * // or const Note = require(\"tonal-note\")\n * Note.name(\"bb2\") // => \"Bb2\"\n * Note.chroma(\"bb2\") // => 10\n * Note.midi(\"a4\") // => 69\n * Note.freq(\"a4\") // => 440\n * Note.oct(\"G3\") // => 3\n *\n * // part of tonal\n * const Tonal = require(\"tonal\")\n * // or import Note from \"tonal\"\n * Tonal.Note.midi(\"d4\") // => 62\n * ```\n *\n * ## Install\n *\n * [![npm install tonal-note](https://nodei.co/npm/tonal-note.png?mini=true)](https://npmjs.org/package/tonal-note/)\n *\n * ## API Documentation\n *\n * @module Note\n */\n\nvar NAMES = \"C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B\".split(\" \");\n\n/**\n * Get a list of note names (pitch classes) within a octave\n *\n * @param {string} accTypes - (Optional, by default \" b#\"). A string with the\n * accidentals types: \" \" means no accidental, \"#\" means sharps, \"b\" mean flats,\n * can be conbined (see examples)\n * @return {Array}\n * @example\n * Note.names(\" b\") // => [ \"C\", \"Db\", \"D\", \"Eb\", \"E\", \"F\", \"Gb\", \"G\", \"Ab\", \"A\", \"Bb\", \"B\" ]\n * Note.names(\" #\") // => [ \"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\", \"G\", \"G#\", \"A\", \"A#\", \"B\" ]\n */\nexport var names = function (accTypes) { return typeof accTypes !== \"string\"\n    ? NAMES.slice()\n    : NAMES.filter(function (n) {\n        var acc = n[1] || \" \";\n        return accTypes.indexOf(acc) !== -1;\n      }); };\n\nvar SHARPS = names(\" #\");\nvar FLATS = names(\" b\");\nvar REGEX = /^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\\d*)\\s*(.*)$/;\n\n/**\n * Split a string into tokens related to note parts.\n * It returns an array of strings `[letter, accidental, octave, modifier]`\n *\n * It always returns an array\n *\n * @param {String} str\n * @return {Array} an array of note tokens\n * @example\n * Note.tokenize(\"C#2\") // => [\"C\", \"#\", \"2\", \"\"]\n * Note.tokenize(\"Db3 major\") // => [\"D\", \"b\", \"3\", \"major\"]\n * Note.tokenize(\"major\") // => [\"\", \"\", \"\", \"major\"]\n * Note.tokenize(\"##\") // => [\"\", \"##\", \"\", \"\"]\n * Note.tokenize() // => [\"\", \"\", \"\", \"\"]\n */\nexport function tokenize(str) {\n  if (typeof str !== \"string\") { str = \"\"; }\n  var m = REGEX.exec(str);\n  if (!m) { return null; }\n  return [m[1].toUpperCase(), m[2].replace(/x/g, \"##\"), m[3], m[4]];\n}\n\nvar NO_NOTE = Object.freeze({\n  pc: null,\n  name: null,\n  step: null,\n  alt: null,\n  oct: null,\n  octStr: null,\n  chroma: null,\n  midi: null,\n  freq: null\n});\n\nvar SEMI = [0, 2, 4, 5, 7, 9, 11];\nvar properties = function (str) {\n  var tokens = tokenize(str);\n  if (tokens[0] === \"\" || tokens[3] !== \"\") { return NO_NOTE; }\n  var letter = tokens[0];\n  var acc = tokens[1];\n  var octStr = tokens[2];\n  var p = { letter: letter, acc: acc, octStr: octStr };\n  p.pc = p.letter + p.acc;\n  p.name = p.pc + octStr;\n  p.step = (p.letter.charCodeAt(0) + 3) % 7;\n  p.alt = p.acc[0] === \"b\" ? -p.acc.length : p.acc.length;\n  p.oct = octStr.length ? +octStr : null;\n  p.chroma = (SEMI[p.step] + p.alt + 120) % 12;\n  p.midi = p.oct !== null ? SEMI[p.step] + p.alt + 12 * (p.oct + 1) : null;\n  p.freq = midiToFreq(p.midi);\n  return Object.freeze(p);\n};\n\nvar memo = function (fn, cache) {\n  if ( cache === void 0 ) cache = {};\n\n  return function (str) { return cache[str] || (cache[str] = fn(str)); };\n};\n\n/**\n * Get note properties. It returns an object with the following information:\n *\n * - name{String}: the note name. The letter is always in uppercase\n * - letter {String}: the note letter, always in uppercase\n * - acc {String}: the note accidentals\n * - octave {Number}: the octave or null if not present\n * - pc{String}: the pitch class (letter + accidentals)\n * - step {Number}: number equivalent of the note letter. 0 means C ... 6 means B.\n * - alt {Number}: number equivalent of accidentals (negative are flats, positive sharps)\n * - chroma {Number}: number equivalent of the pitch class, where 0 is C, 1 is C# or Db, 2 is D...\n * - midi {Number}: the note midi number\n * - freq {Number}: the frequency using an equal temperament at 440Hz\n *\n * This function *always* returns an object with all this properties, but if it\"s\n * not a valid note all properties will be null.\n *\n * The returned object can\"t be mutated.\n *\n * @param {String} note - the note name in scientific notation\n * @return {Object} an object with the properties (or an object will all properties\n * set to null if not valid note)\n * @example\n * Note.props(\"fx-3\").name // => \"F##-3\"\n * Note.props(\"invalid\").name // => null\n * Note.props(\"C#3\").oct // => 3\n * Note.props().oct // => null\n */\nexport var props = memo(properties);\n\n/**\n * Given a note name, return the note name or null if not valid note.\n * The note name will ALWAYS have the letter in upercase and accidentals\n * using # or b\n *\n * Can be used to test if a string is a valid note name.\n *\n * @function\n * @param {Pitch|string}\n * @return {string}\n *\n * @example\n * Note.name(\"cb2\") // => \"Cb2\"\n * [\"c\", \"db3\", \"2\", \"g+\", \"gx4\"].map(Note.name) // => [\"C\", \"Db3\", null, null, \"G##4\"]\n */\nexport var name = function (str) { return props(str).name; };\n\n/**\n * Get pitch class of a note. The note can be a string or a pitch array.\n *\n * @function\n * @param {string|Pitch}\n * @return {string} the pitch class\n * @example\n * Note.pc(\"Db3\") // => \"Db\"\n * [\"db3\", \"bb6\", \"fx2\"].map(Note.pc) // => [ \"Db\", \"Bb\", \"F##\"]\n */\nexport var pc = function (str) { return props(str).pc; };\n\n/**\n * Get the note midi number\n * (an alias of tonal-midi `toMidi` function)\n *\n * @function\n * @param {string|Number} note - the note to get the midi number from\n * @return {Integer} the midi number or null if not valid pitch\n * @example\n * Note.midi(\"C4\") // => 60\n * Note.midi(60) // => 60\n * @see midi.toMidi\n */\nexport var midi = function (note) { return props(note).midi || +note || null; };\n\n/**\n * Get the frequency from midi number\n *\n * @param {Number} midi - the note midi number\n * @param {Number} tuning - (Optional) 440 by default\n * @return {Number} the frequency or null if not valid note midi\n */\nexport var midiToFreq = function (midi, tuning) {\n    if ( tuning === void 0 ) tuning = 440;\n\n    return typeof midi === \"number\" ? Math.pow(2, (midi - 69) / 12) * tuning : null;\n};\n\n/**\n * Get the frequency of a note\n *\n * @function\n * @param {string|Number} note - the note name or midi note number\n * @return {Number} the frequency\n * @example\n * Note.freq(\"A4\") // => 440\n * Note.freq(69) // => 440\n */\nexport var freq = function (note) { return props(note).freq || midiToFreq(note); };\n\nvar L2 = Math.log(2);\nvar L440 = Math.log(440);\n/**\n * Get the midi number from a frequency in hertz. The midi number can\n * contain decimals (with two digits precission)\n *\n * @param {Number} frequency\n * @return {Number}\n * @example\n * Note.freqToMidi(220)); //=> 57;\n * Note.freqToMidi(261.62)); //=> 60;\n * Note.freqToMidi(261)); //=> 59.96;\n */\nexport var freqToMidi = function (freq) {\n  var v = 12 * (Math.log(freq) - L440) / L2 + 69;\n  return Math.round(v * 100) / 100;\n};\n\n/**\n * Return the chroma of a note. The chroma is the numeric equivalent to the\n * pitch class, where 0 is C, 1 is C# or Db, 2 is D... 11 is B\n *\n * @param {string} note - the note name\n * @return {Integer} the chroma number\n * @example\n * Note.chroma(\"Cb\") // => 11\n * [\"C\", \"D\", \"E\", \"F\"].map(Note.chroma) // => [0, 2, 4, 5]\n */\nexport var chroma = function (str) { return props(str).chroma; };\n\n/**\n * Get the octave of the given pitch\n *\n * @function\n * @param {string} note - the note\n * @return {Integer} the octave or null if doesn\"t have an octave or not a valid note\n * @example\n * Note.oct(\"C#4\") // => 4\n * Note.oct(\"C\") // => null\n * Note.oct(\"blah\") // => undefined\n */\nexport var oct = function (str) { return props(str).oct; };\n\nvar LETTERS = \"CDEFGAB\";\n/**\n * Given a step number return it\"s letter (0 = C, 1 = D, 2 = E)\n * @param {number} step\n * @return {string} the letter\n * @example\n * Note.stepToLetter(3) // => \"F\"\n */\nexport var stepToLetter = function (step) { return LETTERS[step]; };\n\nvar fillStr = function (s, n) { return Array(n + 1).join(s); };\nvar numToStr = function (num, op) { return (typeof num !== \"number\" ? \"\" : op(num)); };\n\n/**\n * Given an alteration number, return the accidentals\n * @param {Number} alt\n * @return {String}\n * @example\n * Note.altToAcc(-3) // => \"bbb\"\n */\nexport var altToAcc = function (alt) { return numToStr(alt, function (alt) { return (alt < 0 ? fillStr(\"b\", -alt) : fillStr(\"#\", alt)); }); };\n\n/**\n * Creates a note name in scientific notation from note properties,\n * and optionally another note name.\n * It receives an object with:\n * - step: the note step (0 = C, 1 = D, ... 6 = B)\n * - alt: (optional) the alteration. Negative numbers are flats, positive sharps\n * - oct: (optional) the octave\n *\n * Optionally it receives another note as a \"base\", meaning that any prop not explicitly\n * received on the first parameter will be taken from that base note. That way it can be used\n * as an immutable \"set\" operator for a that base note\n *\n * @function\n * @param {Object} props - the note properties\n * @param {String} [baseNote] - note to build the result from. If given, it returns\n * the result of applying the given props to this note.\n * @return {String} the note name in scientific notation or null if not valid properties\n * @example\n * Note.from({ step: 5 }) // => \"A\"\n * Note.from({ step: 1, acc: -1 }) // => \"Db\"\n * Note.from({ step: 2, acc: 2, oct: 2 }) // => \"E##2\"\n * Note.from({ step: 7 }) // => null\n * Note.from({alt: 1, oct: 3}, \"C4\") // => \"C#3\"\n */\nexport var from = function (fromProps, baseNote) {\n  if ( fromProps === void 0 ) fromProps = {};\n  if ( baseNote === void 0 ) baseNote = null;\n\n  var ref = baseNote\n    ? Object.assign({}, props(baseNote), fromProps)\n    : fromProps;\n  var step = ref.step;\n  var alt = ref.alt;\n  var oct = ref.oct;\n  var letter = stepToLetter(step);\n  if (!letter) { return null; }\n  var pc = letter + altToAcc(alt);\n  return oct || oct === 0 ? pc + oct : pc;\n};\n\n/**\n * Deprecated. This is kept for backwards compatibility only.\n * Use Note.from instead\n */\nexport var build = from;\n\n/**\n * Given a midi number, returns a note name. The altered notes will have\n * flats unless explicitly set with the optional `useSharps` parameter.\n *\n * @function\n * @param {number} midi - the midi note number\n * @param {boolean} useSharps - (Optional) set to true to use sharps instead of flats\n * @return {string} the note name\n * @example\n * Note.fromMidi(61) // => \"Db4\"\n * Note.fromMidi(61, true) // => \"C#4\"\n * // it rounds to nearest note\n * Note.fromMidi(61.7) // => \"D4\"\n */\nexport function fromMidi(num, sharps) {\n  num = Math.round(num);\n  var pcs = sharps === true ? SHARPS : FLATS;\n  var pc = pcs[num % 12];\n  var o = Math.floor(num / 12) - 1;\n  return pc + o;\n}\n\n/**\n * Simplify the note: find an enhramonic note with less accidentals.\n *\n * @param {String} note - the note to be simplified\n * @param {boolean} useSameAccType - (optional, true by default) set to true\n * to ensure the returned note has the same accidental types that the given note\n * @return {String} the simplfiied note or null if not valid note\n * @example\n * Note.simplify(\"C##\") // => \"D\"\n * Note.simplify(\"C###\") // => \"D#\"\n * Note.simplify(\"C###\", false) // => \"Eb\"\n * Note.simplify(\"B#4\") // => \"C5\"\n */\nexport var simplify = function (note, sameAcc) {\n  var ref = props(note);\n  var alt = ref.alt;\n  var chroma = ref.chroma;\n  var midi = ref.midi;\n  if (chroma === null) { return null; }\n  var useSharps = sameAcc === false ? alt < 0 : alt > 0;\n  return midi === null\n    ? pc(fromMidi(chroma, useSharps))\n    : fromMidi(midi, useSharps);\n};\n\n/**\n * Get the simplified and enhramonic note of the given one.\n *\n * @param {String} note\n * @return {String} the enhramonic note\n * @example\n * Note.enharmonic(\"Db\") // => \"C#\"\n * Note.enhramonic(\"C\") // => \"C\"\n */\nexport var enharmonic = function (note) { return simplify(note, false); };\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-array.svg?style=flat-square)](https://www.npmjs.com/package/tonal-array)\n *\n * Tonal array utilities. Create ranges, sort notes, ...\n *\n * @example\n * import * as Array;\n * Array.sort([\"f\", \"a\", \"c\"]) // => [\"C\", \"F\", \"A\"]\n *\n * @example\n * const Array = require(\"tonal-array)\n * Array.range(1, 4) // => [1, 2, 3, 4]\n *\n * @module Array\n */\nimport { midi, name } from \"tonal-note\";\n\n// ascending range\nfunction ascR(b, n) {\n  for (var a = []; n--; a[n] = n + b){ ; }\n  return a;\n}\n// descending range\nfunction descR(b, n) {\n  for (var a = []; n--; a[n] = b - n){ ; }\n  return a;\n}\n\n/**\n * Create a numeric range\n *\n * @param {Number} from\n * @param {Number} to\n * @return {Array}\n *\n * @example\n * Array.range(-2, 2) // => [-2, -1, 0, 1, 2]\n * Array.range(2, -2) // => [2, 1, 0, -1, -2]\n */\nexport function range(a, b) {\n  return a === null || b === null\n    ? []\n    : a < b ? ascR(a, b - a + 1) : descR(a, a - b + 1);\n}\n/**\n *\n * Rotates a list a number of times. It\"s completly agnostic about the\n * contents of the list.\n *\n * @param {Integer} times - the number of rotations\n * @param {Array} array\n * @return {Array} the rotated array\n * @example\n * Array.rotate(1, [1, 2, 3]) // => [2, 3, 1]\n */\nexport function rotate(times, arr) {\n  var len = arr.length;\n  var n = (times % len + len) % len;\n  return arr.slice(n, len).concat(arr.slice(0, n));\n}\n\n/**\n * Return a copy of the array with the null values removed\n * @function\n * @param {Array} array\n * @return {Array}\n *\n * @example\n * Array.compact([\"a\", \"b\", null, \"c\"]) // => [\"a\", \"b\", \"c\"]\n */\nexport var compact = function (arr) { return arr.filter(function (n) { return n === 0 || n; }); };\n\n// a function that get note heights (with negative number for pitch classes)\nvar height = function (n) {\n  var m = midi(n);\n  return m !== null ? m : midi(n + \"-100\");\n};\n\n/**\n * Sort an array of notes in ascending order\n *\n * @param {String|Array} notes\n * @return {Array} sorted array of notes\n */\nexport function sort(src) {\n  return compact(src.map(name)).sort(function (a, b) { return height(a) > height(b); });\n}\n\n/**\n * Get sorted notes with duplicates removed\n *\n * @function\n * @param {Array} notes\n */\nexport function unique(arr) {\n  return sort(arr).filter(function (n, i, a) { return i === 0 || n !== a[i - 1]; });\n}\n\n/**\n * Randomizes the order of the specified array in-place, using the FisherYates shuffle.\n *\n * @private\n * @function\n * @param {Array|String} arr - the array\n * @return {Array} the shuffled array\n *\n * @example\n * Array.shuffle([\"C\", \"D\", \"E\", \"F\"])\n */\nexport var shuffle = function (arr, rnd) {\n  if ( rnd === void 0 ) rnd = Math.random;\n\n  var i, t;\n  var m = arr.length;\n  while (m) {\n    i = (rnd() * m--) | 0;\n    t = arr[m];\n    arr[m] = arr[i];\n    arr[i] = t;\n  }\n  return arr;\n};\n\n/**\n * Get all permutations of an array\n * http://stackoverflow.com/questions/9960908/permutations-in-javascript\n *\n * @param {Array} array - the array\n * @return {Array<Array>} an array with all the permutations\n */\nexport var permutations = function (arr) {\n  if (arr.length === 0) { return [[]]; }\n  return permutations(arr.slice(1)).reduce(function(acc, perm) {\n    return acc.concat(\n      arr.map(function(e, pos) {\n        var newPerm = perm.slice();\n        newPerm.splice(pos, 0, arr[0]);\n        return newPerm;\n      })\n    );\n  }, []);\n};\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-interval.svg)](https://www.npmjs.com/package/tonal-interval)\n * [![tonal](https://img.shields.io/badge/tonal-interval-yellow.svg)](https://www.npmjs.com/browse/keyword/tonal)\n *\n * `tonal-interval` is a collection of functions to create and manipulate music intervals.\n *\n * The intervals are strings in shorthand notation. Two variations are supported:\n *\n * - standard shorthand notation: type and number, for example: \"M3\", \"d-4\"\n * - inverse shorthand notation: number and then type, for example: \"3M\", \"-4d\"\n *\n * The problem with the standard shorthand notation is that some strings can be\n * parsed as notes or intervals, for example: \"A4\" can be note A in 4th octave\n * or an augmented four. To remove ambiguity, the prefered notation in tonal is the\n * inverse shortand notation.\n *\n * This is part of [tonal](https://www.npmjs.com/package/tonal) music theory library.\n *\n * ## Usage\n *\n * ```js\n * // es6\n * import * as Interval from \"tonal-interval\"\n * // es5\n * const Interval = require(\"tonal-interval\")\n * // part of tonal\n * import { Interval } from \"tonal\"\n *\n * Interval.semitones(\"4P\") // => 5\n * Interval.invert(\"3m\") // => \"6M\"\n * Interval.simplify(\"9m\") // => \"2m\"\n * ```\n *\n * ## Install\n *\n * [![npm install tonal-interval](https://nodei.co/npm/tonal-interval.png?mini=true)](https://npmjs.org/package/tonal-interval/)\n *\n * ## API Documentation\n *\n * @module Interval\n */\n// shorthand tonal notation (with quality after number)\nvar IVL_TNL = \"([-+]?\\\\d+)(d{1,4}|m|M|P|A{1,4})\";\n// standard shorthand notation (with quality before number)\nvar IVL_STR = \"(AA|A|P|M|m|d|dd)([-+]?\\\\d+)\";\nvar REGEX = new RegExp(\"^\" + IVL_TNL + \"|\" + IVL_STR + \"$\");\nvar SIZES = [0, 2, 4, 5, 7, 9, 11];\nvar TYPES = \"PMMPPMM\";\nvar CLASSES = [0, 1, 2, 3, 4, 5, 6, 5, 4, 3, 2, 1];\nvar NAMES = \"1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P\".split(\" \");\n\n/**\n * List basic (perfect, major, minor) interval names within a octave\n * @param {String} qualities - (Optional, default \"PMm\") the valid types\n * @return {Array} the interval names\n * @example\n * Interval.names() // => [ \"1P\", \"2m\", \"2M\", \"3m\", \"3M\", \"4P\", \"5P\", \"6m\", \"6M\", \"7m\", \"7M\", \"8P\" ]\n * Interval.names(\"P\") // => [ \"1P\", \"4P\", \"5P\", \"8P\" ]\n * Interval.names(\"PM\") // => [ \"1P\", \"2M\", \"3M\", \"4P\", \"5P\", \"6M\", \"7M\", \"8P\" ]\n * Interval.names(\"Pm\") // => [ \"1P\", \"2m\", \"3m\", \"4P\", \"5P\", \"6m\", \"7m\", \"8P\" ]\n * Interval.names(\"d\") // => []\n */\nexport var names = function (types) { return typeof types !== \"string\"\n    ? NAMES.slice()\n    : NAMES.filter(function (n) { return types.indexOf(n[1]) !== -1; }); };\n\nexport var tokenize = function (str) {\n  var m = REGEX.exec(str);\n  return m === null ? null : m[1] ? [m[1], m[2]] : [m[4], m[3]];\n};\n\nvar NO_IVL = Object.freeze({\n  name: null,\n  num: null,\n  q: null,\n  step: null,\n  alt: null,\n  dir: null,\n  type: null,\n  simple: null,\n  semitones: null,\n  chroma: null\n});\n\nvar fillStr = function (s, n) { return Array(Math.abs(n) + 1).join(s); };\n\nvar qToAlt = function (type, q) {\n  if (q === \"M\" && type === \"M\") { return 0; }\n  if (q === \"P\" && type === \"P\") { return 0; }\n  if (q === \"m\" && type === \"M\") { return -1; }\n  if (/^A+$/.test(q)) { return q.length; }\n  if (/^d+$/.test(q)) { return type === \"P\" ? -q.length : -q.length - 1; }\n  return null;\n};\n\nvar altToQ = function (type, alt) {\n  if (alt === 0) { return type === \"M\" ? \"M\" : \"P\"; }\n  else if (alt === -1 && type === \"M\") { return \"m\"; }\n  else if (alt > 0) { return fillStr(\"A\", alt); }\n  else if (alt < 0) { return fillStr(\"d\", type === \"P\" ? alt : alt + 1); }\n  else { return null; }\n};\n\nvar numToStep = function (num) { return (Math.abs(num) - 1) % 7; };\n\nvar properties = function (str) {\n  var t = tokenize(str);\n  if (t === null) { return NO_IVL; }\n  var p = { num: +t[0], q: t[1] };\n  p.step = numToStep(p.num);\n  p.type = TYPES[p.step];\n  if (p.type === \"M\" && p.q === \"P\") { return NO_IVL; }\n\n  p.name = \"\" + p.num + p.q;\n  p.dir = p.num < 0 ? -1 : 1;\n  p.simple = p.num === 8 || p.num === -8 ? p.num : p.dir * (p.step + 1);\n  p.alt = qToAlt(p.type, p.q);\n  p.oct = Math.floor((Math.abs(p.num) - 1) / 7);\n  p.semitones = p.dir * (SIZES[p.step] + p.alt + 12 * p.oct);\n  p.chroma = ((p.dir * (SIZES[p.step] + p.alt)) % 12 + 12) % 12;\n  return Object.freeze(p);\n};\n\nvar cache = {};\n/**\n * Get interval properties. It returns an object with:\n *\n * - name: name\n * - num: number\n * - q: quality\n * - step: step\n * - alt: alteration\n * - dir: direction (1 ascending, -1 descending)\n * - type: \"P\" or \"M\" for perfectable or majorable\n * - simple: the simplified number\n * - semitones: the size in semitones\n * - chroma: the interval chroma\n * - ic: the interval class\n *\n * @function\n * @param {String} interval - the interval\n * @return {Object} the interval in the form [number, alt]\n */\nexport function props(str) {\n  if (typeof str !== \"string\") { return NO_IVL; }\n  return cache[str] || (cache[str] = properties(str));\n}\n\n/**\n * Get the number of the interval\n *\n * @function\n * @param {String} interval - the interval\n * @return {Integer}\n * @example\n * Interval.num(\"m2\") // => 2\n * Interval.num(\"P9\") // => 9\n * Interval.num(\"P-4\") // => -4\n */\nexport var num = function (str) { return props(str).num; };\n\n/**\n * Get interval name. Can be used to test if it\"s an interval. It accepts intervals\n * as pitch or string in shorthand notation or tonal notation. It returns always\n * intervals in tonal notation.\n *\n * @function\n * @param {String} interval - the interval string or array\n * @return {String} the interval name or null if not valid interval\n * @example\n * Interval.name(\"m-3\") // => \"-3m\"\n * Interval.name(\"3\") // => null\n */\nexport var name = function (str) { return props(str).name; };\n\n/**\n * Get size in semitones of an interval\n *\n * @function\n * @param {String} ivl\n * @return {Integer} the number of semitones or null if not an interval\n * @example\n * import { semitones } from \"tonal-interval\"\n * semitones(\"P4\") // => 5\n * // or using tonal\n * Tonal.Interval.semitones(\"P5\") // => 7\n */\nexport var semitones = function (str) { return props(str).semitones; };\n\n/**\n * Get the chroma of the interval. The chroma is a number between 0 and 7\n * that represents the position within an octave (pitch set)\n *\n * @function\n * @param {String} str\n * @return {Number}\n */\nexport var chroma = function (str) { return props(str).chroma; };\n\n/**\n * Get the [interval class](https://en.wikipedia.org/wiki/Interval_class)\n * number of a given interval.\n *\n * In musical set theory, an interval class is the shortest distance in\n * pitch class space between two unordered pitch classes\n *\n * @function\n * @param {String|Integer} interval - the interval or the number of semitones\n * @return {Integer} A value between 0 and 6\n *\n * @example\n * Interval.ic(\"P8\") // => 0\n * Interval.ic(\"m6\") // => 4\n * Interval.ic(10) // => 2\n * [\"P1\", \"M2\", \"M3\", \"P4\", \"P5\", \"M6\", \"M7\"].map(ic) // => [0, 2, 4, 5, 5, 3, 1]\n */\nexport var ic = function (ivl) {\n  if (typeof ivl === \"string\") { ivl = props(ivl).chroma; }\n  return typeof ivl === \"number\" ? CLASSES[ivl % 12] : null;\n};\n\n/**\n * Given a interval property object, get the interval name\n *\n * The properties must contain a `num` *or* `step`, and `alt`:\n *\n * - num: the interval number\n * - step: the interval step (overrides the num property)\n * - alt: the interval alteration\n * - oct: (Optional) the number of octaves\n * - dir: (Optional) the direction\n *\n * @function\n * @param {Object} props - the interval property object\n *\n * @return {String} the interval name\n * @example\n * Interval.build({ step: 1, alt: -1, oct: 0, dir: 1 }) // => \"1d\"\n * Interval.build({ num: 9, alt: -1 }) // => \"9m\"\n */\nexport var build = function (ref) {\n  if ( ref === void 0 ) ref = {};\n  var num = ref.num;\n  var step = ref.step;\n  var alt = ref.alt;\n  var oct = ref.oct; if ( oct === void 0 ) oct = 1;\n  var dir = ref.dir;\n\n  if (step !== undefined) { num = step + 1 + 7 * oct; }\n  if (num === undefined) { return null; }\n\n  var d = dir < 0 ? \"-\" : \"\";\n  var type = TYPES[numToStep(num)];\n  return d + num + altToQ(type, alt);\n};\n\n/**\n * Get the simplified version of an interval.\n *\n * @function\n * @param {String} interval - the interval to simplify\n * @return {String} the simplified interval\n *\n * @example\n * Interval.simplify(\"9M\") // => \"2M\"\n * [\"8P\", \"9M\", \"10M\", \"11P\", \"12P\", \"13M\", \"14M\", \"15P\"].map(Interval.simplify)\n * // => [ \"8P\", \"2M\", \"3M\", \"4P\", \"5P\", \"6M\", \"7M\", \"8P\" ]\n * Interval.simplify(\"2M\") // => \"2M\"\n * Interval.simplify(\"-2M\") // => \"7m\"\n */\nexport var simplify = function (str) {\n  var p = props(str);\n  if (p === NO_IVL) { return null; }\n  return p.simple + p.q;\n};\n\n/**\n * Get the inversion (https://en.wikipedia.org/wiki/Inversion_(music)#Intervals)\n * of an interval.\n *\n * @function\n * @param {String} interval - the interval to invert in interval shorthand\n * notation or interval array notation\n * @return {String} the inverted interval\n *\n * @example\n * Interval.invert(\"3m\") // => \"6M\"\n * Interval.invert(\"2M\") // => \"7m\"\n */\nexport var invert = function (str) {\n  var p = props(str);\n  if (p === NO_IVL) { return null; }\n  var step = (7 - p.step) % 7;\n  var alt = p.type === \"P\" ? -p.alt : -(p.alt + 1);\n  return build({ step: step, alt: alt, oct: p.oct, dir: p.dir });\n};\n\n// interval numbers\nvar IN = [1, 2, 2, 3, 3, 4, 5, 5, 6, 6, 7, 7];\n// interval qualities\nvar IQ = \"P m M m M P d P m M m M\".split(\" \");\n\n/**\n * Get interval name from semitones number. Since there are several interval\n * names for the same number, the name it\"s arbitraty, but deterministic.\n *\n * @function\n * @param {Integer} num - the number of semitones (can be negative)\n * @return {String} the interval name\n * @example\n * import { fromSemitones } from \"tonal-interval\"\n * fromSemitones(7) // => \"5P\"\n * // or using tonal\n * Tonal.Distance.fromSemitones(-7) // => \"-5P\"\n */\nexport var fromSemitones = function (num) {\n  var d = num < 0 ? -1 : 1;\n  var n = Math.abs(num);\n  var c = n % 12;\n  var o = Math.floor(n / 12);\n  return d * (IN[c] + 7 * o) + IQ[c];\n};\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-distance.svg)](https://www.npmjs.com/package/tonal-distance)\n * [![tonal](https://img.shields.io/badge/tonal-distance-yellow.svg)](https://github.com/danigb/tonal/tree/master/packages/tonal/distance)\n *\n * Transpose notes by intervals and find distances between notes\n *\n * @example\n * // es6\n * import * as Distance from \"tonal-distance\"\n * Distance.interval(\"C3\", \"C4\") // => \"1P\"\n *\n * @example\n * // es6 import selected functions\n * import { interval, semitones, transpose } from \"tonal-distance\"\n *\n * semitones(\"C\" ,\"D\") // => 2\n * interval(\"C4\", \"G4\") // => \"5P\"\n * transpose(\"C4\", \"P5\") // => \"G4\"\n *\n * @example\n * // included in tonal facade\n * const Tonal = require(\"tonal\");\n * Tonal.Distance.transpose(\"C4\", \"P5\")\n * Tonal.Distance.transposeBy(\"P5\", \"C4\")\n *\n * @module Distance\n */\nimport { props as noteProps, build as fromNote } from \"tonal-note\";\nimport { props as iprops, build as ibuild } from \"tonal-interval\";\n\n// Map from letter step to number of fifths starting from \"C\":\n// { C: 0, D: 2, E: 4, F: -1, G: 1, A: 3, B: 5 }\nvar FIFTHS = [0, 2, 4, -1, 1, 3, 5];\n\n// Given a number of fifths, return the octaves they span\nvar fOcts = function (f) { return Math.floor(f * 7 / 12); };\n\n// Get the number of octaves it span each step\nvar FIFTH_OCTS = FIFTHS.map(fOcts);\n\nvar encode = function (ref) {\n  var step = ref.step;\n  var alt = ref.alt;\n  var oct = ref.oct;\n  var dir = ref.dir; if ( dir === void 0 ) dir = 1;\n\n  var f = FIFTHS[step] + 7 * alt;\n  if (oct === null) { return [dir * f]; }\n  var o = oct - FIFTH_OCTS[step] - 4 * alt;\n  return [dir * f, dir * o];\n};\n\n// We need to get the steps from fifths\n// Fifths for CDEFGAB are [ 0, 2, 4, -1, 1, 3, 5 ]\n// We add 1 to fifths to avoid negative numbers, so:\n// for [\"F\", \"C\", \"G\", \"D\", \"A\", \"E\", \"B\"] we have:\nvar STEPS = [3, 0, 4, 1, 5, 2, 6];\n\n// Return the number of fifths as if it were unaltered\nfunction unaltered(f) {\n  var i = (f + 1) % 7;\n  return i < 0 ? 7 + i : i;\n}\n\nvar decode = function (f, o, dir) {\n  var step = STEPS[unaltered(f)];\n  var alt = Math.floor((f + 1) / 7);\n  if (o === undefined) { return { step: step, alt: alt, dir: dir }; }\n  var oct = o + 4 * alt + FIFTH_OCTS[step];\n  return { step: step, alt: alt, oct: oct, dir: dir };\n};\n\nvar memo = function (fn, cache) {\n  if ( cache === void 0 ) cache = {};\n\n  return function (str) { return cache[str] || (cache[str] = fn(str)); };\n};\n\nvar encoder = function (props) { return memo(function (str) {\n    var p = props(str);\n    return p.name === null ? null : encode(p);\n  }); };\n\nvar encodeNote = encoder(noteProps);\nvar encodeIvl = encoder(iprops);\n\n/**\n * Transpose a note by an interval. The note can be a pitch class.\n *\n * This function can be partially applied.\n *\n * @param {String} note\n * @param {String} interval\n * @return {String} the transposed note\n * @example\n * import { tranpose } from \"tonal-distance\"\n * transpose(\"d3\", \"3M\") // => \"F#3\"\n * // it works with pitch classes\n * transpose(\"D\", \"3M\") // => \"F#\"\n * // can be partially applied\n * [\"C\", \"D\", \"E\", \"F\", \"G\"].map(transpose(\"M3)) // => [\"E\", \"F#\", \"G#\", \"A\", \"B\"]\n */\nexport function transpose(note, interval) {\n  if (arguments.length === 1) { return function (i) { return transpose(note, i); }; }\n  var n = encodeNote(note);\n  var i = encodeIvl(interval);\n  if (n === null || i === null) { return null; }\n  var tr = n.length === 1 ? [n[0] + i[0]] : [n[0] + i[0], n[1] + i[1]];\n  return fromNote(decode(tr[0], tr[1]));\n}\n\n/**\n * Transpose a pitch class by a number of perfect fifths.\n *\n * It can be partially applied.\n *\n * @function\n * @param {String} pitchClass - the pitch class\n * @param {Integer} fifhts - the number of fifths\n * @return {String} the transposed pitch class\n *\n * @example\n * import { trFifths } from \"tonal-transpose\"\n * [0, 1, 2, 3, 4].map(trFifths(\"C\")) // => [\"C\", \"G\", \"D\", \"A\", \"E\"]\n * // or using tonal\n * Distance.trFifths(\"G4\", 1) // => \"D\"\n */\n\nexport function trFifths(note, fifths) {\n  if (arguments.length === 1) { return function (f) { return trFifths(note, f); }; }\n  var n = encodeNote(note);\n  if (n === null) { return null; }\n  return fromNote(decode(n[0] + fifths));\n}\n\n/**\n * Get the distance in fifths between pitch classes\n *\n * Can be partially applied.\n *\n * @param {String} to - note or pitch class\n * @param {String} from - note or pitch class\n */\nexport function fifths(from, to) {\n  if (arguments.length === 1) { return function (to) { return fifths(from, to); }; }\n  var f = encodeNote(from);\n  var t = encodeNote(to);\n  if (t === null || f === null) { return null; }\n  return t[0] - f[0];\n}\n\n/**\n * The same as transpose with the arguments inverted.\n *\n * Can be partially applied.\n *\n * @param {String} note\n * @param {String} interval\n * @return {String} the transposed note\n * @example\n * import { tranposeBy } from \"tonal-distance\"\n * transposeBy(\"3m\", \"5P\") // => \"7m\"\n */\nexport function transposeBy(interval, note) {\n  if (arguments.length === 1) { return function (n) { return transpose(n, interval); }; }\n  return transpose(note, interval);\n}\n\nvar isDescending = function (e) { return e[0] * 7 + e[1] * 12 < 0; };\nvar decodeIvl = function (i) { return isDescending(i) ? decode(-i[0], -i[1], -1) : decode(i[0], i[1], 1); };\n\nexport function addIntervals(ivl1, ivl2, dir) {\n  var i1 = encodeIvl(ivl1);\n  var i2 = encodeIvl(ivl2);\n  if (i1 === null || i2 === null) { return null; }\n  var i = [i1[0] + dir * i2[0], i1[1] + dir * i2[1]];\n  return ibuild(decodeIvl(i));\n}\n\n/**\n * Add two intervals\n *\n * Can be partially applied.\n *\n * @param {String} interval1\n * @param {String} interval2\n * @return {String} the resulting interval\n * @example\n * import { add } from \"tonal-distance\"\n * add(\"3m\", \"5P\") // => \"7m\"\n */\nexport function add(ivl1, ivl2) {\n  if (arguments.length === 1) { return function (i2) { return add(ivl1, i2); }; }\n  return addIntervals(ivl1, ivl2, 1);\n}\n\n/**\n * Subtract two intervals\n *\n * Can be partially applied\n *\n * @param {String} minuend\n * @param {String} subtrahend\n * @return {String} interval diference\n */\nexport function subtract(ivl1, ivl2) {\n  if (arguments.length === 1) { return function (i2) { return add(ivl1, i2); }; }\n  return addIntervals(ivl1, ivl2, -1);\n}\n\n/**\n * Find the interval between two pitches. It works with pitch classes\n * (both must be pitch classes and the interval is always ascending)\n *\n * Can be partially applied\n *\n * @param {String} from - distance from\n * @param {String} to - distance to\n * @return {String} the interval distance\n *\n * @example\n * import { interval } from \"tonal-distance\"\n * interval(\"C2\", \"C3\") // => \"P8\"\n * interval(\"G\", \"B\") // => \"M3\"\n *\n * @example\n * import * as Distance from \"tonal-distance\"\n * Distance.interval(\"M2\", \"P5\") // => \"P4\"\n */\nexport function interval(from, to) {\n  if (arguments.length === 1) { return function (t) { return interval(from, t); }; }\n  var f = encodeNote(from);\n  var t = encodeNote(to);\n  if (f === null || t === null || f.length !== t.length) { return null; }\n  var d =\n    f.length === 1\n      ? [t[0] - f[0], -Math.floor((t[0] - f[0]) * 7 / 12)]\n      : [t[0] - f[0], t[1] - f[1]];\n  return ibuild(decodeIvl(d));\n}\n\n/**\n * Get the distance between two notes in semitones\n *\n * @param {String|Pitch} from - first note\n * @param {String|Pitch} to - last note\n * @return {Integer} the distance in semitones or null if not valid notes\n * @example\n * import { semitones } from \"tonal-distance\"\n * semitones(\"C3\", \"A2\") // => -3\n * // or use tonal\n * Tonal.Distance.semitones(\"C3\", \"G3\") // => 7\n */\nexport function semitones(from, to) {\n  if (arguments.length === 1) { return function (t) { return semitones(from, t); }; }\n  var f = noteProps(from);\n  var t = noteProps(to);\n  return f.midi !== null && t.midi !== null\n    ? t.midi - f.midi\n    : f.chroma !== null && t.chroma !== null\n      ? (t.chroma - f.chroma + 12) % 12\n      : null;\n}\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-pcset.svg?style=flat-square)](https://www.npmjs.com/package/tonal-pcset)\n * [![tonal](https://img.shields.io/badge/tonal-pcset-yellow.svg?style=flat-square)](https://www.npmjs.com/browse/keyword/tonal)\n *\n * `tonal-pcset` is a collection of functions to work with pitch class sets, oriented\n * to make comparations (isEqual, isSubset, isSuperset)\n *\n * This is part of [tonal](https://www.npmjs.com/package/tonal) music theory library.\n *\n * You can install via npm: `npm i --save tonal-pcset`\n *\n * ```js\n * // es6\n * import PcSet from \"tonal-pcset\"\n * var PcSet = require(\"tonal-pcset\")\n *\n * PcSet.isEqual(\"c2 d5 e6\", \"c6 e3 d1\") // => true\n * ```\n *\n * ## API documentation\n *\n * @module PcSet\n */\nimport { chroma as notechr } from \"tonal-note\";\nimport { chroma as ivlchr } from \"tonal-interval\";\nimport { rotate, range, compact } from \"tonal-array\";\n\nvar chr = function (str) { return notechr(str) || ivlchr(str) || 0; };\nvar pcsetNum = function (set) { return parseInt(chroma(set), 2); };\nvar clen = function (chroma) { return chroma.replace(/0/g, \"\").length; };\n\n/**\n * Get chroma of a pitch class set. A chroma identifies each set uniquely.\n * It\"s a 12-digit binary each presenting one semitone of the octave.\n *\n * Note that this function accepts a chroma as parameter and return it\n * without modification.\n *\n * @param {Array|String} set - the pitch class set\n * @return {String} a binary representation of the pitch class set\n * @example\n * PcSet.chroma([\"C\", \"D\", \"E\"]) // => \"1010100000000\"\n */\nexport function chroma(set) {\n  if (isChroma(set)) { return set; }\n  if (!Array.isArray(set)) { return \"\"; }\n  var b = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  set.map(chr).forEach(function (i) {\n    b[i] = 1;\n  });\n  return b.join(\"\");\n}\n\nvar all = null;\n/**\n * Get a list of all possible chromas (all possible scales)\n * More information: http://allthescales.org/\n * @return {Array} an array of possible chromas from '10000000000' to '11111111111'\n *\n */\nexport function chromas(n) {\n  all = all || range(2048, 4095).map(function (n) { return n.toString(2); });\n  return typeof n === \"number\"\n    ? all.filter(function (chroma) { return clen(chroma) === n; })\n    : all.slice();\n}\n\n/**\n * Given a a list of notes or a pcset chroma, produce the rotations\n * of the chroma discarding the ones that starts with \"0\"\n *\n * This is used, for example, to get all the modes of a scale.\n *\n * @param {Array|String} set - the list of notes or pitchChr of the set\n * @param {Boolean} normalize - (Optional, true by default) remove all\n * the rotations that starts with \"0\"\n * @return {Array<String>} an array with all the modes of the chroma\n *\n * @example\n * PcSet.modes([\"C\", \"D\", \"E\"]).map(PcSet.intervals)\n */\nexport function modes(set, normalize) {\n  normalize = normalize !== false;\n  var binary = chroma(set).split(\"\");\n  return compact(\n    binary.map(function(_, i) {\n      var r = rotate(i, binary);\n      return normalize && r[0] === \"0\" ? null : r.join(\"\");\n    })\n  );\n}\n\nvar REGEX = /^[01]{12}$/;\n/**\n * Test if the given string is a pitch class set chroma.\n * @param {String} chroma - the pitch class set chroma\n * @return {Boolean} true if its a valid pcset chroma\n * @example\n * PcSet.isChroma(\"101010101010\") // => true\n * PcSet.isChroma(\"101001\") // => false\n */\nexport function isChroma(set) {\n  return REGEX.test(set);\n}\n\nvar IVLS = \"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M\".split(\" \");\n/**\n * Given a pcset (notes or chroma) return it\"s intervals\n * @param {String|Array} pcset - the pitch class set (notes or chroma)\n * @return {Array} intervals or empty array if not valid pcset\n * @example\n * PcSet.intervals(\"1010100000000\") => [\"1P\", \"2M\", \"3M\"]\n */\nexport function intervals(set) {\n  if (!isChroma(set)) { return []; }\n  return compact(\n    set.split(\"\").map(function(d, i) {\n      return d === \"1\" ? IVLS[i] : null;\n    })\n  );\n}\n\n/**\n * Test if two pitch class sets are identical\n *\n * @param {Array|String} set1 - one of the pitch class sets\n * @param {Array|String} set2 - the other pitch class set\n * @return {Boolean} true if they are equal\n * @example\n * PcSet.isEqual([\"c2\", \"d3\"], [\"c5\", \"d2\"]) // => true\n */\nexport function isEqual(s1, s2) {\n  if (arguments.length === 1) { return function (s) { return isEqual(s1, s); }; }\n  return chroma(s1) === chroma(s2);\n}\n\n/**\n * Create a function that test if a collection of notes is a\n * subset of a given set\n *\n * The function can be partially applied\n *\n * @param {Array|String} set - an array of notes or a chroma set string to test against\n * @param {Array|String} notes - an array of notes or a chroma set\n * @return {boolean} true if notes is a subset of set, false otherwise\n * @example\n * const inCMajor = PcSet.isSubsetOf([\"C\", \"E\", \"G\"])\n * inCMajor([\"e6\", \"c4\"]) // => true\n * inCMajor([\"e6\", \"c4\", \"d3\"]) // => false\n */\nexport function isSubsetOf(set, notes) {\n  if (arguments.length > 1) { return isSubsetOf(set)(notes); }\n  set = pcsetNum(set);\n  return function(notes) {\n    notes = pcsetNum(notes);\n    return notes !== set && (notes & set) === notes;\n  };\n}\n\n/**\n * Create a function that test if a collectio of notes is a\n * superset of a given set (it contains all notes and at least one more)\n *\n * @param {Array|String} set - an array of notes or a chroma set string to test against\n * @param {Array|String} notes - an array of notes or a chroma set\n * @return {boolean} true if notes is a superset of set, false otherwise\n * @example\n * const extendsCMajor = PcSet.isSupersetOf([\"C\", \"E\", \"G\"])\n * extendsCMajor([\"e6\", \"a\", \"c4\", \"g2\"]) // => true\n * extendsCMajor([\"c6\", \"e4\", \"g3\"]) // => false\n */\nexport function isSupersetOf(set, notes) {\n  if (arguments.length > 1) { return isSupersetOf(set)(notes); }\n  set = pcsetNum(set);\n  return function(notes) {\n    notes = pcsetNum(notes);\n    return notes !== set && (notes | set) === notes;\n  };\n}\n\n/**\n * Test if a given pitch class set includes a note\n * @param {Array|String} set - the base set to test against\n * @param {String|Pitch} note - the note to test\n * @return {Boolean} true if the note is included in the pcset\n * @example\n * PcSet.includes([\"C\", \"D\", \"E\"], \"C4\") // => true\n * PcSet.includes([\"C\", \"D\", \"E\"], \"C#4\") // => false\n */\nexport function includes(set, note) {\n  if (arguments.length > 1) { return includes(set)(note); }\n  set = chroma(set);\n  return function(note) {\n    return set[chr(note)] === \"1\";\n  };\n}\n\n/**\n * Filter a list with a pitch class set\n *\n * @param {Array|String} set - the pitch class set notes\n * @param {Array|String} notes - the note list to be filtered\n * @return {Array} the filtered notes\n *\n * @example\n * PcSet.filter([\"C\", \"D\", \"E\"], [\"c2\", \"c#2\", \"d2\", \"c3\", \"c#3\", \"d3\"]) // => [ \"c2\", \"d2\", \"c3\", \"d3\" ])\n * PcSet.filter([\"C2\"], [\"c2\", \"c#2\", \"d2\", \"c3\", \"c#3\", \"d3\"]) // => [ \"c2\", \"c3\" ])\n */\nexport function filter(set, notes) {\n  if (arguments.length === 1) { return function (n) { return filter(set, n); }; }\n  return notes.filter(includes(set));\n}\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-dictionary.svg)](https://www.npmjs.com/package/tonal-dictionary)\n *\n * `tonal-dictionary` contains a dictionary of musical scales and chords\n *\n * This is part of [tonal](https://www.npmjs.com/package/tonal) music theory library.\n *\n * @example\n * // es6\n * import * as Dictionary from \"tonal-dictionary\"\n * // es5\n * const Dictionary = require(\"tonal-dictionary\")\n *\n * @example\n * Dictionary.chord(\"Maj7\") // => [\"1P\", \"3M\", \"5P\", \"7M\"]\n *\n * @module Dictionary\n */\nimport sdata from \"./data/scales.json\";\nimport cdata from \"./data/chords.json\";\nimport { chroma } from \"tonal-pcset\";\n\nexport var dictionary = function (raw) {\n  var keys = Object.keys(raw).sort();\n  var data = [];\n  var index = [];\n\n  var add = function (name, ivls, chroma) {\n    data[name] = ivls;\n    index[chroma] = index[chroma] || [];\n    index[chroma].push(name);\n  };\n\n  keys.forEach(function (key) {\n    var ivls = raw[key][0].split(\" \");\n    var alias = raw[key][1];\n    var chr = chroma(ivls);\n\n    add(key, ivls, chr);\n    if (alias) { alias.forEach(function (a) { return add(a, ivls, chr); }); }\n  });\n  var allKeys = Object.keys(data).sort();\n\n  var dict = function (name) { return data[name]; };\n  dict.names = function (p) {\n    if (typeof p === \"string\") { return (index[p] || []).slice(); }\n    else { return (p === true ? allKeys : keys).slice(); }\n  };\n  return dict;\n};\n\nexport var combine = function (a, b) {\n  var dict = function (name) { return a(name) || b(name); };\n  dict.names = function (p) { return a.names(p).concat(b.names(p)); };\n  return dict;\n};\n\n/**\n * A dictionary of scales: a function that given a scale name (without tonic)\n * returns an array of intervals\n *\n * @function\n * @param {String} name\n * @return {Array} intervals\n * @example\n * import { scale } from \"tonal-dictionary\"\n * scale(\"major\") // => [\"1P\", \"2M\", ...]\n * scale.names(); // => [\"major\", ...]\n */\nexport var scale = dictionary(sdata);\n\n/**\n * A dictionary of chords: a function that given a chord type\n * returns an array of intervals\n *\n * @function\n * @param {String} type\n * @return {Array} intervals\n * @example\n * import { chord } from \"tonal-dictionary\"\n * chord(\"Maj7\") // => [\"1P\", \"3M\", ...]\n * chord.names(); // => [\"Maj3\", ...]\n */\nexport var chord = dictionary(cdata);\nexport var pcset = combine(scale, chord);\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-scale.svg?style=flat-square)](https://www.npmjs.com/package/tonal-scale)\n *\n * A scale is a collection of pitches in ascending or descending order.\n *\n * This module provides functions to get and manipulate scales.\n *\n * @example\n * // es6\n * import * as Scale from \"tonal-scale\"\n * // es5\n * const Scale = require(\"tonal-scale\");\n *\n * @example\n * Scale.notes(\"Ab bebop\") // => [ \"Ab\", \"Bb\", \"C\", \"Db\", \"Eb\", \"F\", \"Gb\", \"G\" ]\n * Scale.names() => [\"major\", \"minor\", ...]\n * @module Scale\n */\nimport { name as noteName, pc } from \"tonal-note\";\nimport {\n  modes as pcsetModes,\n  chroma,\n  isSubsetOf,\n  isSupersetOf\n} from \"tonal-pcset\";\nimport { transpose } from \"tonal-distance\";\nimport { scale, chord } from \"tonal-dictionary\";\nimport { compact, unique, rotate } from \"tonal-array\";\n\nvar NO_SCALE = Object.freeze({\n  name: null,\n  intervals: [],\n  names: [],\n  chroma: null,\n  setnum: null\n});\n\nvar properties = function (name) {\n  var intervals = scale(name);\n  if (!intervals) { return NO_SCALE; }\n  var s = { intervals: intervals, name: name };\n  s.chroma = chroma(intervals);\n  s.setnum = parseInt(s.chroma, 2);\n  s.names = scale.names(s.chroma);\n  return Object.freeze(s);\n};\n\nvar memoize = function (fn, cache) { return function (str) { return cache[str] || (cache[str] = fn(str)); }; };\n\n/**\n * Get scale properties. It returns an object with:\n * - name: the scale name\n * - names: a list with all possible names (includes the current)\n * - intervals: an array with the scale intervals\n * - chroma:  scale croma (see pcset)\n * - setnum: scale chroma number\n *\n * @function\n * @param {String} name - the scale name (without tonic)\n * @return {Object}\n */\nexport var props = memoize(properties, {});\n\n/**\n * Return the available scale names\n *\n * @function\n * @param {boolean} aliases - true to include aliases\n * @return {Array} the scale names\n *\n * @example\n * Scale.names() // => [\"maj7\", ...]\n */\nexport var names = scale.names;\n\n/**\n * Given a scale name, return its intervals. The name can be the type and\n * optionally the tonic (which is ignored)\n *\n * It retruns an empty array when no scale found\n *\n * @function\n * @param {String} name - the scale name (tonic and type, tonic is optional)\n * @return {Array<String>} the scale intervals if is a known scale or an empty\n * array if no scale found\n * @example\n * Scale.intervals(\"major\") // => [ \"1P\", \"2M\", \"3M\", \"4P\", \"5P\", \"6M\", \"7M\" ]\n */\nexport var intervals = function (name) {\n  var p = tokenize(name);\n  return props(p[1]).intervals;\n};\n\n/**\n * Get the notes (pitch classes) of a scale.\n *\n * Note that it always returns an array, and the values are only pitch classes.\n *\n * @function\n * @param {String} tonic\n * @param {String} nameOrTonic - the scale name or tonic (if 2nd param)\n * @param {String} [name] - the scale name without tonic\n * @return {Array} a pitch classes array\n *\n * @example\n * Scale.notes(\"C\", \"major\") // => [ \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\" ]\n * Scale.notes(\"C major\") // => [ \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\" ]\n * Scale.notes(\"C4\", \"major\") // => [ \"C\", \"D\", \"E\", \"F\", \"G\", \"A\", \"B\" ]\n * Scale.notes(\"A4\", \"no-scale\") // => []\n * Scale.notes(\"blah\", \"major\") // => []\n */\nexport function notes(nameOrTonic, name) {\n  var p = tokenize(nameOrTonic);\n  name = name || p[1];\n  return intervals(name).map(transpose(p[0]));\n}\n\n/**\n * Check if the given name is a known scale from the scales dictionary\n *\n * @function\n * @param {String} name - the scale name\n * @return {Boolean}\n */\nexport function exists(name) {\n  var p = tokenize(name);\n  return scale(p[1]) !== undefined;\n}\n\n/**\n * Given a string with a scale name and (optionally) a tonic, split\n * that components.\n *\n * It retuns an array with the form [ name, tonic ] where tonic can be a\n * note name or null and name can be any arbitrary string\n * (this function doesn\"t check if that scale name exists)\n *\n * @function\n * @param {String} name - the scale name\n * @return {Array} an array [tonic, name]\n * @example\n * Scale.tokenize(\"C mixolydean\") // => [\"C\", \"mixolydean\"]\n * Scale.tokenize(\"anything is valid\") // => [\"\", \"anything is valid\"]\n * Scale.tokenize() // => [\"\", \"\"]\n */\nexport function tokenize(str) {\n  if (typeof str !== \"string\") { return [\"\", \"\"]; }\n  var i = str.indexOf(\" \");\n  var tonic = noteName(str.substring(0, i)) || noteName(str) || \"\";\n  var name = tonic !== \"\" ? str.substring(tonic.length + 1) : str;\n  return [tonic, name.length ? name : \"\"];\n}\n\n/**\n * Find mode names of a scale\n *\n * @function\n * @param {String} name - scale name\n */\nexport var modeNames = function (name) {\n  var ivls = intervals(name);\n  var tonics = notes(name);\n\n  return pcsetModes(ivls)\n    .map(function (chroma, i) {\n      var name = scale.names(chroma)[0];\n      if (name) { return [tonics[i] || ivls[i], name]; }\n    })\n    .filter(function (x) { return x; });\n};\n\n/**\n * Get all chords that fits a given scale\n *\n * @function\n * @param {String} name\n */\nexport var chords = function (name) {\n  var inScale = isSubsetOf(intervals(name));\n  return chord.names().filter(function (name) { return inScale(chord(name)); });\n};\n\n/**\n * Given an array of notes, return the scale: a pitch class set starting from\n * the first note of the array\n *\n * @function\n * @param {Array} notes\n * @return {Array}\n */\nexport var toScale = function (notes) {\n  var pcset = compact(notes.map(pc));\n  if (!pcset.length) { return pcset; }\n  var tonic = pcset[0];\n  var scale = unique(pcset);\n  return rotate(scale.indexOf(tonic), scale);\n};\n\n/**\n * Get all scales names that are a superset of the given one\n * (has the same notes and at least one more)\n *\n * @function\n * @param {String} name\n * @return {Array} a list of scale names\n */\nexport var supersets = function (name) {\n  if (!intervals(name).length) { return []; }\n  var isSuperset = isSupersetOf(intervals(name));\n  return scale.names().filter(function (name) { return isSuperset(scale(name)); });\n};\n\n/**\n * Find all scales names that are a subset of the given one\n * (has less notes but all from the given scale)\n *\n * @function\n * @param {String} name\n * @return {Array} a list of scale names\n */\nexport var subsets = function (name) {\n  var isSubset = isSubsetOf(intervals(name));\n  return scale.names().filter(function (name) { return isSubset(scale(name)); });\n};\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-chord.svg)](https://www.npmjs.com/package/tonal-chord)\n * [![tonal](https://img.shields.io/badge/tonal-chord-yellow.svg)](https://www.npmjs.com/browse/keyword/tonal)\n *\n * `tonal-chord` is a collection of functions to manipulate musical chords\n *\n * This is part of [tonal](https://www.npmjs.com/package/tonal) music theory library.\n *\n * @example\n * // es6\n * import * as Chord from \"tonal-chord\"\n * // es5\n * const Chord = require(\"tonal-chord\")\n *\n * @example\n * Chord.notes(\"CMaj7\") // => [\"C\", \"E\", \"G\", \"B\"]\n *\n * @module Chord\n */\nimport { tokenize as split } from \"tonal-note\";\nimport { transpose } from \"tonal-distance\";\nimport { chord } from \"tonal-dictionary\";\nimport { chroma, isSubsetOf, isSupersetOf } from \"tonal-pcset\";\n\n/**\n * Return the available chord names\n *\n * @function\n * @param {boolean} aliases - true to include aliases\n * @return {Array} the chord names\n *\n * @example\n * Chord.names() // => [\"maj7\", ...]\n */\nexport var names = chord.names;\n\nvar NO_CHORD = Object.freeze({\n  name: null,\n  names: [],\n  intervals: [],\n  chroma: null,\n  setnum: null\n});\n\nvar properties = function (name) {\n  var intervals = chord(name);\n  if (!intervals) { return NO_CHORD; }\n  var s = { intervals: intervals, name: name };\n  s.chroma = chroma(intervals);\n  s.setnum = parseInt(s.chroma, 2);\n  s.names = chord.names(s.chroma);\n  return s;\n};\n\nvar memo = function (fn, cache) {\n  if ( cache === void 0 ) cache = {};\n\n  return function (str) { return cache[str] || (cache[str] = fn(str)); };\n};\n\n/**\n * Get chord properties. It returns an object with:\n *\n * - name: the chord name\n * - names: a list with all possible names (includes the current)\n * - intervals: an array with the chord intervals\n * - chroma:  chord croma (see pcset)\n * - setnum: chord chroma number\n *\n * @function\n * @param {String} name - the chord name (without tonic)\n * @return {Object} an object with the properties or a object with all properties\n * set to null if not valid chord name\n */\nexport var props = memo(properties);\n\n/**\n * Get chord intervals. It always returns an array\n *\n * @function\n * @param {String} name - the chord name (optionally a tonic and type)\n * @return {Array<String>} a list of intervals or null if the type is not known\n */\nexport var intervals = function (name) { return props(tokenize(name)[1]).intervals; };\n\n/**\n * Get the chord notes of a chord. This function accepts either a chord name\n * (for example: \"Cmaj7\") or a list of notes.\n *\n * It always returns an array, even if the chord is not found.\n *\n * @function\n * @param {String} nameOrTonic - name of the chord or the tonic (if the second parameter is present)\n * @param {String} [name] - (Optional) name if the first parameter is the tonic\n * @return {Array} an array of notes or an empty array\n *\n * @example\n * Chord.notes(\"Cmaj7\") // => [\"C\", \"E\", \"G\", \"B\"]\n * Chord.notes(\"C\", \"maj7\") // => [\"C\", \"E\", \"G\", \"B\"]\n */\nexport function notes(nameOrTonic, name) {\n  var p = tokenize(nameOrTonic);\n  name = name || p[1];\n  return props(name).intervals.map(transpose(p[0]));\n}\n\n/**\n * Check if a given name correspond to a chord in the dictionary\n *\n * @function\n * @param {String} name\n * @return {Boolean}\n * @example\n * Chord.exists(\"CMaj7\") // => true\n * Chord.exists(\"Maj7\") // => true\n * Chord.exists(\"Ablah\") // => false\n */\nexport var exists = function (name) { return chord(tokenize(name)[1]) !== undefined; };\n\n/**\n * Get all chords names that are a superset of the given one\n * (has the same notes and at least one more)\n *\n * @function\n * @param {String} name\n * @return {Array} a list of chord names\n */\nexport var supersets = function (name) {\n  if (!intervals(name).length) { return []; }\n  var isSuperset = isSupersetOf(intervals(name));\n  return chord.names().filter(function (name) { return isSuperset(chord(name)); });\n};\n\n/**\n * Find all chords names that are a subset of the given one\n * (has less notes but all from the given chord)\n *\n * @function\n * @param {String} name\n * @return {Array} a list of chord names\n */\nexport var subsets = function (name) {\n  var isSubset = isSubsetOf(intervals(name));\n  return chord.names().filter(function (name) { return isSubset(chord(name)); });\n};\n\n// 6, 64, 7, 9, 11 and 13 are consider part of the chord\n// (see https://github.com/danigb/tonal/issues/55)\nvar NUM_TYPES = /^(6|64|7|9|11|13)$/;\n/**\n * Tokenize a chord name. It returns an array with the tonic and chord type\n * If not tonic is found, all the name is considered the chord name.\n *\n * This function does NOT check if the chord type exists or not. It only tries\n * to split the tonic and chord type.\n *\n * @function\n * @param {String} name - the chord name\n * @return {Array} an array with [type, tonic]\n * @example\n * Chord.tokenize(\"Cmaj7\") // => [ \"C\", \"maj7\" ]\n * Chord.tokenize(\"C7\") // => [ \"C\", \"7\" ]\n * Chord.tokenize(\"mMaj7\") // => [ \"\", \"mMaj7\" ]\n * Chord.tokenize(\"Cnonsense\") // => [ \"C\", \"nonsense\" ]\n */\nexport function tokenize(name) {\n  var p = split(name);\n  if (p[0] === \"\") { return [\"\", name]; }\n  // aug is augmented (see https://github.com/danigb/tonal/issues/55)\n  if (p[0] === \"A\" && p[3] === \"ug\") { return [\"\", \"aug\"]; }\n\n  if (NUM_TYPES.test(p[2])) {\n    return [p[0] + p[1], p[2] + p[3]];\n  } else {\n    return [p[0] + p[1] + p[2], p[3]];\n  }\n}\n","/**\n * [![npm version](https://img.shields.io/npm/v/tonal-key.svg?style=flat-square)](https://www.npmjs.com/package/tonal-key)\n *\n * The `Tonal` module is a facade to the rest of the modules. They are namespaced,\n * so for example to use `pc` function from `tonal-note` you have to write:\n * `Tonal.Note.pc`\n *\n * It exports the following modules:\n * - Note\n * - Interval\n * - Distance\n * - Scale\n * - Chord\n * - PcSet\n *\n * Additionally this facade exports some functions without namespace (see \"Methods\" below)\n *\n * @example\n * // es6 modules\n * import * as Tonal from \"tonal\"\n * Tonal.Note.name(\"cx\") // => \"C##\"\n *\n * @example\n * import { Note } from \"tonal\"\n * Note.name(\"bb\") // => \"Bb\"\n *\n * @example\n * // es5 node modules\n * var Tonal = require(\"tonal\");\n * Tonal.Distance.transpose(Tonal.Note.pc(\"C#2\"), \"M3\") // => \"E#\"\n * Tonal.Chord.notes(\"Dmaj7\") // => [\"D\", \"F#\", \"A\", \"C#\"]\n *\n * @module Tonal\n */\nimport * as Array from \"tonal-array\";\nimport * as Note from \"tonal-note\";\nimport * as Interval from \"tonal-interval\";\nimport * as Distance from \"tonal-distance\";\nimport * as Dictionary from \"tonal-dictionary\";\nimport * as Scale from \"tonal-scale\";\nimport * as Chord from \"tonal-chord\";\nimport * as PcSet from \"tonal-pcset\";\n\nexport { Array, Note, Interval, Distance, Scale, Chord, PcSet, Dictionary };\n\n/**\n * Transpose a note by an interval\n * @function\n * @param {String} note\n * @param {String} interval\n * @return {String} the transported note\n * @see Distance.transpose\n */\nexport const transpose = Distance.transpose;\n\n/**\n * Get the interval from two notes\n * @function\n * @param {String} from\n * @param {String} to\n * @return {String} the interval in reverse shorthand notation\n * @see Distance.interval\n */\nexport const interval = Distance.interval;\n\n/**\n * Get note properties\n * @function\n * @param {String} note - the note name\n * @return {Object}\n * @see Note.props\n * @example\n * Tonal.note(\"A4\").chroma // => 9\n */\nexport const note = Note.props;\n\n/**\n * Get midi note number\n * @function\n * @param {String} note\n * @return {Number}\n * @see Note.midi\n * @example\n * Tonal.midi(\"A4\") // => 49\n */\nexport const midi = Note.midi;\n\n/**\n * Get note frequency using equal tempered tuning at 440\n * @function\n * @param {String} note\n * @return {Number}\n * @see Note.freq\n * @example\n * Tonal.freq(\"A4\") // => 440\n */\nexport const freq = Note.freq;\n\n/**\n * Get intervals from a chord type\n * @function\n * @param {String} type - the chord type (no tonic)\n * @return {Array} an array of intervals or undefined if the chord type is not known\n * @see Dictionary.chord\n * @example\n * Tonal.chord(\"m7b5\") // => [\"1P\", \"3m\", \"5d\", \"7m\"]\n */\nexport const chord = Dictionary.chord;\n\n/**\n * Get intervals from scale name\n * @function\n * @param {String} name - the scale name (without tonic)\n * @return {Array} an array of intervals or undefiend if the scale is not kown\n * @example\n * Tonal.scale(\"major\") // => [\"1P\", \"2M\", \"3M\"...]\n */\nexport const scale = Dictionary.scale;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"../util\");\nvar Instrument = /** @class */ (function () {\n    function Instrument(_a) {\n        var _b = _a === void 0 ? {} : _a, context = _b.context, gain = _b.gain, mix = _b.mix, onPlay = _b.onPlay, onStop = _b.onStop, midiOffset = _b.midiOffset;\n        this.midiOffset = 0;\n        this.gain = 1;\n        this.onPlay = onPlay;\n        this.midiOffset = midiOffset || this.midiOffset;\n        this.onStop = onStop;\n        this.gain = gain || this.gain;\n        this.init({ context: context, mix: mix });\n    }\n    Instrument.prototype.init = function (_a) {\n        var context = _a.context, mix = _a.mix;\n        if (!context && (!mix || !mix.context)) {\n            console.warn(\"you should pass a context or a mix (gainNode) to a new Instrument. \\n            You can also Call init with {context,mix} to setup the Instrument later\");\n            return;\n        }\n        this.context = context || mix.context;\n        this.mix = mix || this.context.destination;\n    };\n    Instrument.prototype.playNotes = function (notes, settings) {\n        var _this = this;\n        this.playKeys(notes.map(function (note) { return util_1.getMidi(note, _this.midiOffset); }), settings);\n    };\n    Instrument.prototype.playKeys = function (keys, settings) {\n        if (this.onPlay) {\n            return this.onPlay(keys);\n        }\n        // TODO: fire callbacks after keys.map((key,i)=>i*settings.interval)?\n    };\n    return Instrument;\n}());\nexports.Instrument = Instrument;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Instrument_1 = require(\"./Instrument\");\nvar tonal_1 = require(\"tonal\");\nvar util_1 = require(\"../util\");\nvar Synthesizer = /** @class */ (function (_super) {\n    __extends(Synthesizer, _super);\n    function Synthesizer(props) {\n        var _this = _super.call(this, props) || this;\n        _this.duration = 200;\n        _this.type = 'sine';\n        _this.gain = 0.9;\n        _this.attack = .05;\n        _this.decay = .05;\n        _this.sustain = .4;\n        _this.release = .1;\n        _this.duration = props.duration || _this.duration;\n        _this.type = props.type || _this.type;\n        _this.gain = props.gain || _this.gain;\n        return _this;\n    }\n    Synthesizer.prototype.init = function (context) {\n        _super.prototype.init.call(this, context);\n    };\n    Synthesizer.prototype.getVoice = function (type, gain, frequency) {\n        if (type === void 0) { type = 'sine'; }\n        if (gain === void 0) { gain = 0; }\n        if (frequency === void 0) { frequency = 440; }\n        var oscNode = this.context.createOscillator();\n        oscNode.type = type;\n        var gainNode = this.context.createGain();\n        oscNode.connect(gainNode);\n        gainNode.gain.value = typeof gain === 'number' ? gain : 0.8;\n        gainNode.connect(this.mix);\n        oscNode.frequency.value = frequency;\n        return { oscNode: oscNode, gainNode: gainNode };\n    };\n    Synthesizer.prototype.lowestGain = function (a, b) {\n        return a.gain.gain.value < b.gain.gain.value ? -1 : 0;\n    };\n    Synthesizer.prototype.playKeys = function (keys, settings) {\n        var _this = this;\n        if (settings === void 0) { settings = {}; }\n        _super.prototype.playKeys.call(this, keys, settings); // fires callback   \n        //const time = this.context.currentTime + settings.deadline / 1000;\n        var time = settings.deadline || this.context.currentTime;\n        var interval = settings.interval || 0;\n        keys.map(function (key, i) {\n            var delay = i * interval;\n            var _a = [\n                settings.attack || _this.attack,\n                settings.decay || _this.decay,\n                settings.sustain || _this.sustain,\n                settings.release || _this.release,\n                (settings.duration || _this.duration) / 1000,\n                (settings.gain || 1) * _this.gain\n            ], attack = _a[0], decay = _a[1], sustain = _a[2], release = _a[3], duration = _a[4], gain = _a[5];\n            var voice = _this.getVoice(_this.type, 0, tonal_1.Note.freq(key));\n            util_1.adsr({ attack: attack, decay: decay, sustain: sustain, release: release, gain: gain, duration: duration, }, time + delay, voice.gainNode.gain);\n            voice.oscNode.start(settings.deadline + delay);\n        });\n    };\n    return Synthesizer;\n}(Instrument_1.Instrument));\nexports.Synthesizer = Synthesizer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tonal_1 = require(\"tonal\");\nvar Synthesizer_1 = require(\"./instruments/Synthesizer\");\nfunction randomNumber(n) {\n    return Math.floor(Math.random() * n);\n}\nexports.randomNumber = randomNumber;\nfunction arraySum(array) {\n    return array.reduce(function (s, i) { return s + i; }, 0);\n}\nexports.arraySum = arraySum;\nfunction randomElement(array, weighted) {\n    if (!weighted) {\n        return array[randomNumber(array.length)];\n    }\n    var r = randomNumber(arraySum(weighted)) + 1;\n    var total = weighted\n        .reduce(function (abs, w, i) { return abs.concat(w + (abs.length ? abs[i - 1] : 0)); }, []);\n    return array[total.indexOf(total.find(function (s, i) { return s >= r; }))];\n}\nexports.randomElement = randomElement;\nfunction getTonalChord(chord) {\n    chord = chord\n        .replace('-', 'm')\n        .replace('^', 'M')\n        .replace('h7', 'm7b5')\n        .replace('h', 'dim');\n    /**\n     * Chords that dont work:\n     * slash cords are ignored\n     * 7b9b5 does not work\n     *\n     */\n    var tokens = tonal_1.Chord.tokenize(chord);\n    var s = tokens[1].split('/');\n    return tokens[0] + (s[0] || 'M');\n}\nexports.getTonalChord = getTonalChord;\nfunction getMidi(note, offset) {\n    return tonal_1.Note.props(note).midi - offset;\n}\nexports.getMidi = getMidi;\n/** Travels path along measures */\nfunction getPath(path, measures, traveled) {\n    if (traveled === void 0) { traveled = []; }\n    if (!Array.isArray(measures[path[0]]) || path.length === 1) {\n        return measures[Math.min(path[0], measures.length - 1)];\n    }\n    return this.getPath(path.slice(1), measures[path[0]], traveled.concat(path[0]));\n}\nexports.getPath = getPath;\nfunction resolveChords(pattern, measures, path, divisions) {\n    var _this = this;\n    if (divisions === void 0) { divisions = []; }\n    if (Array.isArray(pattern)) {\n        // division: array of children lengths down the path (to calculate fraction)\n        divisions = [].concat(divisions, [pattern.length]);\n        return pattern.map(function (p, i) { return _this.resolveChords(p, measures, path.concat([i]), divisions); });\n    }\n    if (pattern === 0) {\n        return 0;\n    }\n    //const split = (pattern + '').split('.');\n    //const gain = parseFloat('0.' + split[1]); //digit(s) after .\n    //const fraction = (parseInt(split[0]) || 1) * divisions.reduce((f, d) => f / d, 1000); // fraction of one\n    var fraction = pattern * divisions.reduce(function (f, d) { return f / d; }, 1000); // fraction of one\n    if (fraction === 0) {\n        console.warn('fraction is 0', pattern);\n    }\n    return { chord: this.getPath(path, measures), pattern: pattern, /* gain, */ path: path, divisions: divisions, fraction: fraction };\n}\nexports.resolveChords = resolveChords;\nfunction hasOff(pattern, division) {\n    if (division === void 0) { division = 3; }\n    return Array.isArray(pattern) && pattern.length === division && pattern[division - 1] !== 0;\n}\nexports.hasOff = hasOff;\n// replaces offs on last beat with next chord + erases next one\nfunction offbeatReducer(settings) {\n    var _this = this;\n    // TODO: find out why some offbeats sound sketchy\n    return function (measures, bar, index) {\n        var last = index > 0 ? measures[index - 1] : null;\n        if (last && _this.hasOff(last[settings.cycle - 1], settings.division)) {\n            last[settings.cycle - 1][settings.division - 1] = bar[0];\n            bar[0] = 0;\n        }\n        return measures.concat([bar]);\n    };\n}\nexports.offbeatReducer = offbeatReducer;\nfunction invertInterval(interval) {\n    if (tonal_1.Interval.semitones(interval) < 0) {\n        return tonal_1.Interval.invert(interval.slice(1));\n    }\n    return '-' + tonal_1.Interval.invert(interval);\n}\nexports.invertInterval = invertInterval;\n// use Interval.ic?\nfunction smallestInterval(interval) {\n    interval = tonal_1.Interval.simplify(interval);\n    if (interval === '0A') {\n        interval = '1P'; // TODO: issue for tonal-interval (0A does not support invert and is not simple)\n    }\n    var inversion = this.invertInterval(interval);\n    if (Math.abs(tonal_1.Interval.semitones(inversion)) < Math.abs(tonal_1.Interval.semitones(interval))) {\n        return inversion;\n    }\n    return interval || '';\n}\nexports.smallestInterval = smallestInterval;\nfunction minInterval(a, b, preferRightMovement) {\n    var semitones = [Math.abs(tonal_1.Interval.semitones(a)), Math.abs(tonal_1.Interval.semitones(b))];\n    if (semitones[0] === semitones[1]) {\n        if (preferRightMovement) {\n            return semitones[0] < 0 ? -1 : 1;\n        }\n        return semitones[0] > 0 ? -1 : 1;\n    }\n    return semitones[0] < semitones[1] ? -1 : 1;\n}\nexports.minInterval = minInterval;\nfunction intervalMatrix(from, to) {\n    var _this = this;\n    return to.map(function (note) { return from\n        .map(function (n) {\n        return tonal_1.Distance.interval(n, note);\n    })\n        .map(function (d) { return _this.smallestInterval(d); })\n        .map(function (i) { return i.slice(0, 2) === '--' ? i.slice(1) : i; }); });\n}\nexports.intervalMatrix = intervalMatrix;\nfunction randomSynth(mix, allowed) {\n    if (allowed === void 0) { allowed = ['sine', 'triangle', 'square', 'sawtooth']; }\n    var gains = {\n        sine: 0.9,\n        triangle: 0.8,\n        square: 0.2,\n        sawtooth: 0.3\n    };\n    var wave = randomElement(allowed);\n    return new Synthesizer_1.Synthesizer({ gain: gains[wave], type: wave, mix: mix });\n}\nexports.randomSynth = randomSynth;\nfunction adsr(_a, time, param) {\n    var attack = _a.attack, decay = _a.decay, sustain = _a.sustain, release = _a.release, gain = _a.gain, duration = _a.duration;\n    // console.log('adsr', attack, decay, sustain, release, gain, duration, time);\n    param.linearRampToValueAtTime(gain, time + attack);\n    param.setTargetAtTime(sustain * gain, time + Math.min(attack + decay, duration), decay);\n    param.setTargetAtTime(0, time + Math.max(duration - attack - decay, attack + decay, duration), release);\n}\nexports.adsr = adsr;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Musician = /** @class */ (function () {\n    function Musician(instrument) {\n        if (!instrument) {\n            console.warn('musician has no instrument', this);\n        }\n        this.instrument = instrument;\n        this.ready = this.instrument ? this.instrument.ready : Promise.resolve();\n    }\n    Musician.prototype.play = function (_a) {\n        var pulse = _a.pulse, measures = _a.measures, settings = _a.settings;\n        console.log('play..', pulse, measures, settings);\n    };\n    return Musician;\n}());\nexports.Musician = Musician;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"../util\");\nexports.swing = {\n    chords: function (_a) {\n        var measure = _a.measure, settings = _a.settings;\n        var off = function () { return util_1.randomElement([0, [0, 0, 2]], [6, 1]); };\n        var r = Math.random() > 0.5 ? .6 : 0;\n        var t = settings.cycle + \"/\" + measure.length;\n        if (t === '4/1') {\n            return util_1.randomElement([\n                [[1, 0], [0, 0, 7], 0, 0],\n                [1, [0, 0, 2], 0, off()],\n                [[0, 0, 1], 0, 2, 0],\n                [[0, 0, 4], 0, 1, 0],\n                [2, 0, 0, 0],\n                [3, 0, 0, 0],\n                [1, 0, r, off()],\n                [[0, 0, 2], 0, r, 0],\n                [1.5, [0, 0, 2], 0, off()],\n            ]); //, [2, 1, 1]\n        }\n        if (t === '4/2') {\n            return util_1.randomElement([\n                [[1, 0], [0, 0, 7], 0, 0],\n                [1, [0, 0, 2], 0, 0],\n                [1, 0, 2, 0],\n                [2, 0, 1, 0],\n                [1, 0, .7, off()],\n                [[1, 0, 0], 0, .7, off()],\n                [[4, 0, 0], [0, 0, 2.8], 0, off()],\n            ]);\n        }\n        if (t === '4/3') {\n            return [1, [0, 0, 2], [0, 0, 4], 0];\n        }\n        if ('4/4') {\n            return util_1.randomElement([\n                [1, 1, 1, 1],\n                [[1, 0, 2], [0, 0, 2], 0, 1]\n            ]);\n        }\n    },\n    bass: function () { return util_1.randomElement([\n        [1, 1, 1, 1],\n    ]); },\n    crash: function (_a) {\n        var measures = _a.measures, index = _a.index;\n        var fill = index !== 0 && index % measures.length === 0;\n        if (fill) {\n            return [4, 0, 0, 0];\n        }\n        return [0, 0, 0, 0];\n    },\n    ride: function (_a) {\n        var measures = _a.measures, index = _a.index;\n        return util_1.randomElement([\n            [.6, [.9, 0, 1], .6, [.9, 0, 1]],\n            [.6, [.4, 0, 1], .8, [0, 0, 1],],\n            [.6, .9, [.6, 0, 1], 1],\n            [.6, .9, .6, [.9, 0, 1]],\n        ], [3, 2, 1, 2]);\n    },\n    hihat: function () { return [0, .8, 0, 1]; }\n};\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tonal_1 = require(\"tonal\");\nvar tonal_2 = require(\"tonal\");\nvar util_1 = require(\"../util\");\nvar Musician_1 = require(\"./Musician\");\nvar swing_1 = require(\"../grooves/swing\");\nvar Pianist = /** @class */ (function (_super) {\n    __extends(Pianist, _super);\n    function Pianist(instrument, props) {\n        if (props === void 0) { props = {}; }\n        var _this = _super.call(this, instrument) || this;\n        _this.playedNotes = [];\n        _this.playedPatterns = [];\n        _this.playedChords = [];\n        _this.defaults = { intelligentVoicings: true, groove: swing_1.swing, noTonic: true };\n        _this.min = Math.min;\n        _this.rollFactor = 3; // how much keyroll effect? controls interval between notes\n        _this.props = Object.assign({}, _this.defaults, props || {});\n        return _this;\n    }\n    Pianist.prototype.play = function (_a) {\n        var _this = this;\n        var pulse = _a.pulse, measures = _a.measures, settings = _a.settings;\n        var groove = settings.groove || this.defaults.groove;\n        var pattern = groove['chords'];\n        if (!pattern) {\n            console.warn('style has no chords..');\n            return;\n        }\n        var measureLength = pulse.getMeasureLength();\n        if (settings.exact) {\n            return pulse.tickArray(measures, function (t) {\n                _this.playChord(t.value, { deadline: t.deadline + settings.delay });\n            });\n        }\n        measures = measures\n            // generate random patterns\n            .map(function (measure) { return pattern({ measures: measures, pulse: pulse, measure: measure, settings: settings }).slice(0, Math.floor(settings.cycle)); })\n            // fill in chords\n            .map(function (pattern, i) { return util_1.resolveChords(pattern, measures, [i]); })\n            // fix chords at last offbeat\n            .reduce(util_1.offbeatReducer(settings), []);\n        pulse.tickArray(measures, function (_a) {\n            var path = _a.path, value = _a.value, deadline = _a.deadline;\n            var humanFactor = settings.bpm / (_this.rollFactor || 1);\n            var interval = settings.arpeggio ? measureLength / settings.cycle : Math.random() / (humanFactor * 20);\n            if (path[0] % 2 === 0 && !path[1] && !path[2]) {\n                interval = Math.random() / humanFactor;\n            }\n            var duration = settings.arpeggio ? interval : value.fraction * measureLength;\n            var slice = settings.arpeggio ? Math.ceil(value.fraction / 1000 * 4) : null;\n            var gain = value.gain || _this.instrument.gain;\n            _this.playChord(value.chord, { deadline: deadline, gain: gain, duration: duration, interval: interval, slice: slice });\n        }, settings.deadline);\n    };\n    Pianist.prototype.getLastVoicing = function () {\n        return this.playedNotes.length ? this.playedNotes[this.playedNotes.length - 1] : null;\n    };\n    Pianist.prototype.getVoicing = function (scorenotes, before, tonic) {\n        if (!before) {\n            return scorenotes;\n        }\n        var near = util_1.intervalMatrix(before, scorenotes)\n            .map(function (intervals, index) {\n            var smallest = [].concat(intervals)\n                .sort(function (a, b) { return util_1.minInterval(a, b, false); })[0];\n            if (!tonal_1.Distance.transpose(before[intervals.indexOf(smallest)], smallest)) {\n                console.warn('ALARM', before[intervals.indexOf(smallest)], smallest, intervals);\n            }\n            return tonal_1.Distance.transpose(before[intervals.indexOf(smallest)], smallest);\n        }).filter(function (n) { return !!n; });\n        return near && near.length ? near : scorenotes;\n    };\n    // plays the given notes at the given interval\n    Pianist.prototype.playNotes = function (scorenotes, _a) {\n        var tonic = _a.tonic, deadline = _a.deadline, interval = _a.interval, gain = _a.gain, duration = _a.duration;\n        if (this.props.intelligentVoicings && this.getLastVoicing()) {\n            scorenotes = this.getVoicing(scorenotes, this.getLastVoicing(), tonic);\n        }\n        this.playedNotes.push([].concat(scorenotes));\n        this.instrument.playNotes(scorenotes, { deadline: deadline, interval: interval, gain: gain, duration: duration });\n    };\n    Pianist.prototype.playChord = function (chord, settings) {\n        if (chord === 'N.C.') {\n            console.log('N.C.');\n            return;\n        }\n        if (!chord || chord === 'x') { // repeat\n            chord = this.playedChords[this.playedChords.length - 1];\n        }\n        this.playedChords.push(chord);\n        chord = tonal_2.Chord.tokenize(util_1.getTonalChord(chord));\n        var notes = tonal_2.Chord.intervals(chord[1])\n            .map(function (i) { return i.replace('13', '6'); }) // TODO: better control over octave\n            .map(function (root) { return tonal_1.Distance.transpose(chord[0] + '3', root); });\n        if (notes.length > 3 && settings.noTonic) {\n            notes = notes.slice(this.props.noTonic ? 1 : 0);\n        }\n        if (settings.slice) {\n            notes = notes.slice(0, settings.slice ? settings.slice : notes.length);\n        }\n        this.playNotes(notes, settings);\n    };\n    return Pianist;\n}(Musician_1.Musician));\nexports.default = Pianist;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Musician_1 = require(\"./Musician\");\nvar swing_1 = require(\"../grooves/swing\");\nvar Drummer = /** @class */ (function (_super) {\n    __extends(Drummer, _super);\n    function Drummer(instrument) {\n        var _this = _super.call(this, instrument) || this;\n        _this.set = {\n            kick: 0,\n            snare: 1,\n            hihat: 2,\n            ride: 3,\n            crash: 4\n        };\n        _this.defaults = { groove: swing_1.swing };\n        return _this;\n    }\n    Drummer.prototype.play = function (_a) {\n        var _this = this;\n        var measures = _a.measures, pulse = _a.pulse, settings = _a.settings;\n        var groove = settings.groove || this.defaults.groove;\n        Object.keys(groove)\n            .filter(function (t) { return Object.keys(_this.set).includes(t); }) // only use drum set patterns\n            .forEach(function (key) {\n            var patterns = measures\n                .map(function (measure, index) { return groove[key]({ measures: measures, index: index, measure: measure, settings: settings, pulse: pulse })\n                .slice(0, Math.floor(settings.cycle)); });\n            pulse.tickArray(patterns, function (_a) {\n                var deadline = _a.deadline, value = _a.value;\n                _this.instrument.playKeys([_this.set[key]], { deadline: deadline, gain: value });\n            }, settings.deadline);\n        });\n    };\n    return Drummer;\n}(Musician_1.Musician));\nexports.default = Drummer;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"../util\");\nvar Musician_1 = require(\"./Musician\");\nvar tonal_1 = require(\"tonal\");\nvar swing_1 = require(\"../grooves/swing\");\nvar Bassist = /** @class */ (function (_super) {\n    __extends(Bassist, _super);\n    function Bassist(instrument) {\n        var _this = _super.call(this, instrument) || this;\n        _this.defaults = { groove: swing_1.swing };\n        _this.playedChords = [];\n        return _this;\n    }\n    Bassist.prototype.play = function (_a) {\n        var _this = this;\n        var measures = _a.measures, pulse = _a.pulse, settings = _a.settings;\n        var groove = settings.groove || this.defaults.groove;\n        var pattern = groove['bass'];\n        measures = measures\n            .map(function (measure) { return pattern({ measures: measures, measure: measure, settings: settings, pulse: pulse }).slice(0, Math.floor(settings.cycle)); })\n            .map(function (pattern, i) { return util_1.resolveChords(pattern, measures, [i]); });\n        pulse.tickArray(measures, function (tick) {\n            _this.playBass(tick, measures, pulse);\n        }, settings.deadline);\n    };\n    Bassist.prototype.getStep = function (step, chord, octave) {\n        if (octave === void 0) { octave = 1; }\n        var tokens = tonal_1.Chord.tokenize(util_1.getTonalChord(chord));\n        var interval = tonal_1.Chord.intervals(tokens[1]).find(function (i) { return parseInt(i[0]) === step; });\n        return tonal_1.Distance.transpose(tokens[0] + octave, interval);\n    };\n    Bassist.prototype.playBass = function (_a, measures, pulse) {\n        var value = _a.value, cycle = _a.cycle, path = _a.path, deadline = _a.deadline, interval = _a.interval;\n        var chord = value.chord;\n        if (chord === 'N.C.') {\n            return;\n        }\n        if (!chord || chord === 'x') { // repeat // TODO: support 'r' \n            chord = this.playedChords[this.playedChords.length - 1];\n        }\n        this.playedChords.push(chord);\n        var note;\n        var steps = [1, util_1.randomElement([3, 5]), 1, util_1.randomElement([3, 5])];\n        var octave = 1;\n        if (value.value === 1 && chord.split('/').length > 1) {\n            note = chord.split('/')[1] + octave;\n        }\n        else {\n            note = this.getStep(steps[path[1]], util_1.getTonalChord(chord), octave);\n        }\n        var duration = value.fraction * pulse.getMeasureLength();\n        this.instrument.playNotes([note], { deadline: deadline, interval: interval, gain: 0.7, duration: duration });\n    };\n    return Bassist;\n}(Musician_1.Musician));\nexports.default = Bassist;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Instrument_1 = require(\"./Instrument\");\nvar util_1 = require(\"../util\");\nvar Sampler = /** @class */ (function (_super) {\n    __extends(Sampler, _super);\n    function Sampler(options) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this, options) || this;\n        _this.buffers = {};\n        _this.duration = 10000;\n        _this.type = 'sine';\n        _this.gain = 1;\n        _this.attack = 0;\n        _this.decay = 0;\n        _this.sustain = 1;\n        _this.release = .2;\n        _this.gain = options.gain || _this.gain;\n        _this.gainNode = _this.context.createGain();\n        _this.gainNode.connect(_this.context.destination);\n        _this.duration = options.duration || _this.duration;\n        // this.overlap = options.overlap;\n        if (options.samples) {\n            _this.sources = options.samples;\n            _this.ready = _this.loadSources(options.samples);\n        }\n        return _this;\n    }\n    // returns buffer from buffer cache or loads buffer data from source\n    Sampler.prototype.getBuffer = function (src, context) {\n        var _this = this;\n        if (context === void 0) { context = this.context; }\n        if (this.buffers[src] && this.buffers[src].context === context) {\n            // console.log('buffer already present');\n            return Promise.resolve(this.buffers[src].buffer);\n        }\n        return fetch(src)\n            .then(function (res) { return res.arrayBuffer(); })\n            .then(function (buffer) {\n            return new Promise(function (resolve, reject) {\n                context.decodeAudioData(buffer, function (decodedData) {\n                    _this.buffers[src] = { buffer: decodedData, context: context };\n                    resolve(decodedData);\n                });\n            });\n        });\n    };\n    Sampler.prototype.getSource = function (buffer, connect) {\n        var source = this.context.createBufferSource();\n        connect = connect || this.gainNode;\n        source.buffer = buffer;\n        source.connect(connect);\n        return source;\n    };\n    Sampler.prototype.getSources = function (sources, context) {\n        var _this = this;\n        if (context === void 0) { context = this.context; }\n        if (!this.hasLoaded(sources)) {\n            console.error('not all sources loaded!!!');\n            return [];\n        }\n        return sources.map(function (source) { return _this.getSource(_this.buffers[source].buffer); });\n    };\n    // loads a sound file into the context\n    Sampler.prototype.loadSource = function (src, context) {\n        var _this = this;\n        if (context === void 0) { context = this.context; }\n        return this.getBuffer(src, context)\n            .then(function (decodedData) { return _this.getSource(decodedData); });\n    };\n    // loads multiple sources into the context\n    Sampler.prototype.loadSources = function (sources, context) {\n        var _this = this;\n        if (context === void 0) { context = this.context; }\n        sources.forEach(function (source, i) {\n            if (!source) {\n                console.warn(\"note at index \" + i + \" cannot be played!\");\n            }\n        });\n        return Promise.all(sources.filter(function (source) { return !!source; }).map(function (source) { return _this.loadSource(source, context); }));\n    };\n    Sampler.prototype.hasLoaded = function (sources, context) {\n        var _this = this;\n        if (context === void 0) { context = this.context; }\n        return sources.reduce(function (allLoaded, src) {\n            return allLoaded && _this.buffers[src] && _this.buffers[src].context === context;\n        }, true);\n    };\n    Sampler.prototype.playSounds = function (sounds, deadline, interval) {\n        if (deadline === void 0) { deadline = 0; }\n        if (interval === void 0) { interval = 0; }\n        sounds.forEach(function (sound, i) { return sound.start(deadline + interval * i); });\n    };\n    Sampler.prototype.playSource = function (source, settings) {\n        var gainNode = this.context.createGain();\n        var sound = this.getSource(this.buffers[source].buffer, gainNode);\n        var _a = [\n            settings.attack || this.attack,\n            settings.decay || this.decay,\n            settings.sustain || this.sustain,\n            settings.release || this.release,\n            (settings.duration || this.duration) / 1000,\n            (settings.gain || 1) * this.gain\n        ], attack = _a[0], decay = _a[1], sustain = _a[2], release = _a[3], duration = _a[4], gain = _a[5];\n        var time = settings.deadline || this.context.currentTime;\n        //gainNode.gain.value = typeof settings.gain === 'number' ? settings.gain : this.gain;\n        gainNode.connect(this.mix);\n        util_1.adsr({ attack: attack, decay: decay, sustain: sustain, release: release, gain: gain, duration: duration, }, time, gainNode.gain);\n        this.playSounds([sound], settings.deadline || 0, 0);\n    };\n    /* playSources(sources, deadline = 0, interval = 0) {\n        if (this.hasLoaded(sources, this.context)) {\n            this.playSounds(this.getSources(sources, this.context), deadline, interval)\n        } else {\n            console.warn('need to load');\n            this.loadSources(sources, this.context)\n                .then(sounds => this.playSounds(sounds, deadline, interval));\n        }\n    } */\n    Sampler.prototype.playKeys = function (keys, settings) {\n        var _this = this;\n        _super.prototype.playKeys.call(this, keys, settings);\n        keys.map(function (key) {\n            _this.playSource(_this.sources[key], settings);\n        });\n    };\n    return Sampler;\n}(Instrument_1.Instrument));\nexports.Sampler = Sampler;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Kick = /** @class */ (function () {\n    function Kick(context) {\n        this.context = context;\n    }\n    Kick.prototype.setup = function () {\n        this.osc = this.context.createOscillator();\n        this.gain = this.context.createGain();\n        this.osc.connect(this.gain);\n        this.gain.connect(this.context.destination);\n    };\n    Kick.prototype.trigger = function (time) {\n        this.setup();\n        this.osc.frequency.setValueAtTime(150, time);\n        this.gain.gain.setValueAtTime(1, time);\n        this.osc.frequency.exponentialRampToValueAtTime(0.01, time + 0.5);\n        this.gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5);\n        this.osc.start(time);\n        this.osc.stop(time + 0.5);\n    };\n    return Kick;\n}());\nexports.Kick = Kick;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Snare = /** @class */ (function () {\n    function Snare(context) {\n        this.context = context;\n    }\n    Snare.prototype.noiseBuffer = function () {\n        var bufferSize = this.context.sampleRate;\n        var buffer = this.context.createBuffer(1, bufferSize, this.context.sampleRate);\n        var output = buffer.getChannelData(0);\n        for (var i = 0; i < bufferSize; i++) {\n            output[i] = Math.random() * 2 - 1;\n        }\n        return buffer;\n    };\n    Snare.prototype.setup = function () {\n        this.noise = this.context.createBufferSource();\n        this.noise.buffer = this.noiseBuffer();\n        var noiseFilter = this.context.createBiquadFilter();\n        noiseFilter.type = 'highpass';\n        noiseFilter.frequency.value = 1000;\n        this.noise.connect(noiseFilter);\n        this.noiseEnvelope = this.context.createGain();\n        noiseFilter.connect(this.noiseEnvelope);\n        this.noiseEnvelope.connect(this.context.destination);\n        this.osc = this.context.createOscillator();\n        this.osc.type = 'triangle';\n        this.oscEnvelope = this.context.createGain();\n        this.osc.connect(this.oscEnvelope);\n        this.oscEnvelope.connect(this.context.destination);\n    };\n    ;\n    Snare.prototype.trigger = function (time) {\n        this.setup();\n        this.noiseEnvelope.gain.setValueAtTime(1, time);\n        this.noiseEnvelope.gain.exponentialRampToValueAtTime(0.01, time + 0.2);\n        this.noise.start(time);\n        this.osc.frequency.setValueAtTime(100, time);\n        this.oscEnvelope.gain.setValueAtTime(0.7, time);\n        this.oscEnvelope.gain.exponentialRampToValueAtTime(0.01, time + 0.1);\n        this.osc.start(time);\n        this.osc.stop(time + 0.2);\n        this.noise.stop(time + 0.2);\n    };\n    ;\n    return Snare;\n}());\nexports.Snare = Snare;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Instrument_1 = require(\"./Instrument\");\nvar Kick_1 = require(\"./Kick\");\nvar Snare_1 = require(\"./Snare\");\nvar PlasticDrums = /** @class */ (function (_super) {\n    __extends(PlasticDrums, _super);\n    function PlasticDrums(options) {\n        var _this = _super.call(this, options) || this;\n        _this.keys = [\n            new Kick_1.Kick(_this.context),\n            new Snare_1.Snare(_this.context)\n        ];\n        return _this;\n    }\n    PlasticDrums.prototype.playKeys = function (keys, _a) {\n        var _this = this;\n        var deadline = _a.deadline, gain = _a.gain, value = _a.value;\n        var sounds = keys.filter(function (key) { return !!_this.keys[key]; }).map(function (key) { return _this.keys[key]; });\n        if (sounds.length < keys.length) {\n            var missing = keys.filter(function (key) { return !_this.keys[key]; });\n            console.warn('PlasticDrums missing keys:', missing);\n        }\n        sounds.forEach(function (sound) { return sound.trigger(deadline); });\n    };\n    return PlasticDrums;\n}(Instrument_1.Instrument));\nexports.PlasticDrums = PlasticDrums;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Synthesizer_1 = require(\"./instruments/Synthesizer\");\nvar Metronome = /** @class */ (function () {\n    function Metronome(mix) {\n        this.synth = new Synthesizer_1.Synthesizer({ type: 'sine', gain: 1, mix: mix });\n        this.ready = this.synth.ready;\n    }\n    Metronome.prototype.count = function (pulse, bars) {\n        var _this = this;\n        if (bars === void 0) { bars = 1; }\n        var count = new Array(bars).fill([new Array(pulse.props.cycle).fill(1)]);\n        return pulse.tickArray(count, function (_a) {\n            var path = _a.path, deadline = _a.deadline;\n            _this.synth.playKeys([path[2] === 0 ? 90 : 78], { deadline: deadline, duration: 0.01, attack: .01, release: .01, decay: .01, sustain: 1 });\n        });\n    };\n    return Metronome;\n}());\nexports.Metronome = Metronome;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar util_1 = require(\"./util\");\nvar Band_1 = __importDefault(require(\"./Band\"));\nvar Pianist_1 = __importDefault(require(\"./musicians/Pianist\"));\nvar Bassist_1 = __importDefault(require(\"./musicians/Bassist\"));\nvar Drummer_1 = __importDefault(require(\"./musicians/Drummer\"));\nvar PlasticDrums_1 = require(\"./instruments/PlasticDrums\");\nvar Metronome_1 = require(\"./Metronome\");\nvar Pulse_1 = require(\"./Pulse\");\nvar Trio = /** @class */ (function (_super) {\n    __extends(Trio, _super);\n    function Trio(_a) {\n        var context = _a.context, piano = _a.piano, bass = _a.bass, drums = _a.drums;\n        var _this = _super.call(this, { context: context }) || this;\n        _this.mix = _this.setupMix(_this.context);\n        var instruments = _this.setupInstruments({ piano: piano, bass: bass, drums: drums });\n        _this.pianist = new Pianist_1.default(instruments.piano);\n        _this.bassist = new Bassist_1.default(instruments.bass);\n        _this.drummer = new Drummer_1.default(instruments.drums);\n        _this.musicians = [_this.pianist, _this.bassist, _this.drummer];\n        _this.metronome = new Metronome_1.Metronome(_this.mix);\n        return _this;\n    }\n    Trio.prototype.setupMix = function (context) {\n        var mix = context.createGain();\n        mix.gain.value = 0.9;\n        mix.connect(context.destination);\n        return mix;\n    };\n    Trio.prototype.setupInstruments = function (_a) {\n        var piano = _a.piano, bass = _a.bass, drums = _a.drums;\n        bass = bass || util_1.randomSynth(this.mix);\n        piano = piano || util_1.randomSynth(this.mix);\n        drums = drums || new PlasticDrums_1.PlasticDrums({ mix: this.mix });\n        return { piano: piano, bass: bass, drums: drums };\n    };\n    Trio.prototype.play = function (measures, settings) {\n        var _this = this;\n        this.pulse = settings.pulse || new Pulse_1.Pulse(settings);\n        return this.count(this.pulse, settings.metronome ? null : 0).then(function (tick) {\n            settings.deadline = tick.deadline;\n            // settings.delay = deadline - this.context.currentTime;\n            _super.prototype.play.call(_this, measures, settings);\n        });\n    };\n    Trio.prototype.count = function (pulse, bars) {\n        if (bars === void 0) { bars = 1; }\n        if (pulse.getMeasureLength() < 1.5) {\n            bars *= 2; //double countin bars when countin would be shorter than 1.5s\n        }\n        return this.metronome.count(pulse, bars);\n    };\n    return Trio;\n}(Band_1.default));\nexports.Trio = Trio;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Band_1 = __importDefault(require(\"./Band\"));\nexports.Band = Band_1.default;\nvar Pianist_1 = __importDefault(require(\"./musicians/Pianist\"));\nexports.Pianist = Pianist_1.default;\nvar Drummer_1 = __importDefault(require(\"./musicians/Drummer\"));\nexports.Drummer = Drummer_1.default;\nvar Bassist_1 = __importDefault(require(\"./musicians/Bassist\"));\nexports.Bassist = Bassist_1.default;\nvar Instrument_1 = require(\"./instruments/Instrument\");\nexports.Instrument = Instrument_1.Instrument;\nvar Musician_1 = require(\"./musicians/Musician\");\nexports.Musician = Musician_1.Musician;\nvar Synthesizer_1 = require(\"./instruments/Synthesizer\");\nexports.Synthesizer = Synthesizer_1.Synthesizer;\nvar Sampler_1 = require(\"./instruments/Sampler\");\nexports.Sampler = Sampler_1.Sampler;\nvar PlasticDrums_1 = require(\"./instruments/PlasticDrums\");\nexports.PlasticDrums = PlasticDrums_1.PlasticDrums;\nvar Trio_1 = require(\"./Trio\");\nexports.Trio = Trio_1.Trio;\nvar util = __importStar(require(\"./util\"));\nexports.util = util;\nvar Pulse_1 = require(\"./Pulse\");\nexports.Pulse = Pulse_1.Pulse;\n","// extension of https://github.com/daumling/ireal-renderer/blob/master/src/ireal-renderer.js\n\nexport class RealParser {\n    /**\n     * The RegExp for a complete chord. The match array contains:\n     * 1 - the base note\n     * 2 - the modifiers (+-ohd0123456789 and su for sus)\n     * 3 - any comments (may be e.g. add, sub, or private stuff)\n     * 4 - the \"over\" part starting with a slash\n     * 5 - the top chord as (chord)\n     * @type RegExp\n     */\n\n    chordRegex = /^([ A-GW][b#]?)((?:sus|[\\+\\-\\^\\dhob#])*)(\\*.+?\\*)*(\\/[A-G][#b]?)?(\\(.*?\\))?/;\n\n    regExps = [\n        /^\\*[a-zA-Z]/,\t\t\t\t\t\t\t// section\n        /^T\\d\\d/,\t\t\t\t\t\t\t\t// time measurement\n        /^N./,\t\t\t\t\t\t\t\t\t// repeat marker\n        /^<.*?>/,\t\t\t\t\t\t\t\t// comments\n        /^ \\(.*?\\)/,\t\t\t\t\t\t\t// blank and (note)\n        this.chordRegex,\t\t\t\t// chords\n        /^LZ/,\t\t\t\t\t\t\t\t\t// 1 cell + right bar\n        /^XyQ/,\t\t\t\t\t\t\t\t\t// 3 empty cells\n        /^Kcl/\t\t\t\t\t\t\t\t\t// repeat last bar\n    ];\n\n    replacements = {\n        \"LZ\": [\" \", \"|\"],\n        \"XyQ\": [\" \", \" \", \" \"],\n        \"Kcl\": [\"|\", \"x\", \" \"]\n    };\n    raw: string;\n    sections: any; //chords json\n    bars: any;\n    tokens: any;\n\n    constructor(raw, times = 3) {\n        this.raw = raw;\n        this.tokens = this.parse(raw);\n        this.sections = this.getSections(this.tokens);\n        //this.bars = parsed.out;\n        this.bars = this.renderSong(this.sections, times);\n        return raw;\n    }\n\n    renderSong(sections = this.sections, times = 1) {\n        let bars = [];\n        console.log('times', times);\n        for (let i = 1; i <= times; ++i) {\n            bars = bars.concat(this.getBars(sections, { first: i === 1, last: i === times }));\n        }\n        return bars;\n    }\n\n    getBars(sections = this.sections, { first, last }, repeated = []) {\n        return sections.filter(s => first || s.section !== 'i')\n            .reduce((current, section, sectionIndex) => {\n                let endings = [].concat(section.endings);\n                if (repeated.find(r => r[0] === section.section)) {\n                    endings = endings.slice(1);\n                    //console.log('already repeated that section..');\n                }\n                if (endings.length) {\n                    current.bars = current.bars.concat(section.bars.concat(endings[0]));\n                    if (section.jumpToCoda) {\n                        console.warn('CODA in section with endings... not implemented yet..');\n                    }\n                } else {\n                    let sectionBars = [].concat(section.bars)\n                    if (section.jumpToCoda && last) {\n                        console.log('jumpToCoda', section.jumpToCoda, sectionBars);\n                        sectionBars = sectionBars.slice(0, section.jumpToCoda);\n                        if (section.repeats) {\n                            console.warn('ALARM: jumpToCoda in section with repeats.. not implemented yet..')\n                            // TODO: support jumpToCoda in section with repeats\n                        }\n                    }\n                    current.bars = current.bars.concat(sectionBars);\n                }\n                if (section.repeats.length) { // splice repeats\n                    //console.log('repeats', section.repeats);\n                    section.repeats.forEach((repeat, index) => {\n                        if (repeat[0] !== null) {\n                            current.repeatStart = [sectionIndex, repeat[0]];\n                        }\n                        const skip = !!repeated.find(r => r[0] === section.section && r[1] === repeat[1]);\n                        if (repeat[1] && !skip) {\n                            if (!current.repeatStart) { // if no { at start.. see lover man\n                                console.log('no repeat start found', repeat);\n                                current.repeatStart = [0, 0];\n                            }\n                            const repeatedSections = sections.slice(current.repeatStart[0], sectionIndex + 1);\n                            repeated.push([section.section, repeat[1]])\n                            /* console.log('repeated sections', repeatedSections); */\n                            const insert = this.getBars(repeatedSections, { first, last }, repeated);\n                            /* console.log('insert', insert); */\n                            current.bars = current.bars.concat(insert);\n                        }\n                    })\n                }\n                return current;\n            }, { bars: [], repeatStart: null, repeatEnd: null }).bars\n            .reduce((b, bar) => {\n                if (bar.length === 1 && bar[0] === 'r') {\n                    b = b.concat(['x', 'x']);\n                } else {\n                    b.push(bar);\n                }\n                return b;\n            }, []);\n    }\n\n\n    getSections(tokens) {\n        return tokens.reduce((current, token, index) => {\n\n            // not working correctly: \n            // \"Pretty Girl Is Like A Melody, A\" => bar with \"/\"\n            // current token has barline => end current.bar\n\n            // beginning of new section\n            const sectionStart = token.annots.find(annotation => annotation.match(/^\\*[a-zA-Z]/));\n            const codaSign = token.annots.includes('Q');\n            const segnioSign = token.annots.includes('S'); // TODO: add segnio\n            const codaJump = codaSign && current.section.jumpToCoda === null;\n            const codaStart = codaSign && !codaJump;\n            const houseStart = token.annots.find(annotation => annotation.match(/^N./));\n            const lastToken = index === tokens.length - 1;\n\n            // new bar\n            if (['{', '|', '[', 'Z', '||', ']'].includes(token.bars || token.token)) {\n                //if (!current.bar.length && (!sectionStart || codaStart)) {\n                // current.bar = ['N.C.']; // TODO: write N.C. directly when parsing\n                //}\n                if (current.bar.length) {\n                    //current.out.push(current.bar);\n                    if (current.section) {\n                        (current.house || current.section.bars).push(current.bar);\n                    }\n                    current.bar = [];\n                }\n            }\n            // sectionSign or second coda sign\n            if (sectionStart || codaStart || lastToken) {\n                if (current.section) {\n                    if (current.house) {\n                        current.section.endings.push(current.house);\n                        current.house = null;\n                    }\n                    current.sections.push(current.section);\n                }\n                delete current.section;\n            }\n            // either first bar without section name or new section sign\n            if (!current.section) {// && !lastToken\n                current.section = {\n                    section: codaStart ? 'coda' : (sectionStart || '').replace('*', '') || 'A',\n                    bars: [],\n                    repeats: [],\n                    endings: [],\n                    jumpToCoda: null,\n                    annotations: {}\n                };\n            }\n            const barIndex = current.section.bars.length + (current.house || []).length;\n            if (codaJump) {\n                current.section.jumpToCoda = barIndex;\n            }\n            // beginning of house\n            if (houseStart) {\n                if (current.house) {\n                    current.section.endings.push(current.house);\n                    current.house = null;\n                }\n                current.house = [];\n            }\n\n            if (token.chord) {\n                current.bar.push(token.chord.note + token.chord.modifiers);\n                //current.bar.push(token);\n            }\n            if (token.annots.length) {\n                current.section.annotations[barIndex] = token.annots;\n            }\n            if (token.bars === '{') {\n                current.section.repeats.push([barIndex]);\n            }\n            if (token.bars === '}' || token.token === '}') { // see lover man: bars is empty but token is }\n                if (current.section.repeats.length && current.section.repeats[current.section.repeats.length - 1]) {\n                    current.section.repeats[current.section.repeats.length - 1].push(barIndex);\n                } else {\n                    console.warn('end loop without start in section');\n                    current.section.repeats.push([null, barIndex]);\n                }\n            }\n            return current;\n        }, { /* out: [], */ sections: [], house: null, bar: [], section: null }).sections;\n    }\n\n    parse(raw: string): any {\n        var text = raw;\n        var arr = [], headers = [], comments = [];\n        var i;\n        text = text.trim();\n        // text = text.trimRight();\n        while (text) {\n            var found = false;\n            for (i = 0; i < this.regExps.length; i++) {\n                var match = this.regExps[i].exec(text);\n\n                if (match) {\n                    found = true;\n                    if (match.length <= 2) {\n                        const replacement = match[0];\n                        var repl = this.replacements[replacement];\n                        arr = arr.concat(repl ? repl : [replacement]);\n                        text = text.substr(replacement.length);\n                    }\n                    else { // a chord\n                        arr.push(match);\n                        text = text.substr(match[0].length);\n                    }\n                    break;\n                }\n            }\n            if (!found) {\n                // ignore the comma separator\n                if (text[0] !== ',')\n                    arr.push(text[0]);\n                text = text.substr(1);\n            }\n        }\n        //\t\tconsole.log(arr);\n        // pass 2: extract prefixes, suffixes, annotations and comments\n        var out = [];\n        var obj = this.newToken(out);\n        for (i = 0; i < arr.length; i++) {\n            var token = arr[i];\n            if (token instanceof Array) {\n                obj.chord = this.parseChord(token);\n                token = \" \";\n            }\n            switch (token[0]) {\n                case ',': token = null; break; // separator\n                case 'S':\t// segno\n                case 'T':\t// time measurement\n                case 'Q':\t// coda\n                case 'N':\t// repeat\n                case 'U':\t// END\n                case 's':\t// small\n                case 'l':\t// normal\n                case 'f':\t// fermata\n                case '*': obj.annots.push(token); token = null; break;\n                case 'Y': obj.spacer++; token = null; break;\n                case 'r':\n                case 'x':\n                case 'W':\n                    obj.chord = new iRealChord(token, \"\", null, null);\n                    break;\n                case '<':\n                    token = token.substr(1, token.length - 2);\n                    token = token.replace(/XyQ/g, \"   \");\t// weird; needs to be done\n                    obj.comments.push(token);\n                    token = null; break;\n                default:\n            }\n            if (token) {\n                if (\"]}Z\".indexOf(arr[i + 1]) >= 0)\n                    obj.bars += arr[++i];\n                if (\"{[|\".indexOf(token) >= 0) {\n                    obj.bars += token; token = null;\n                }\n            }\n            if (token && i < arr.length - 1) {\n                obj.token = token;\n                obj = this.newToken(out);\n            }\n        }\n        return out;\n    }\n\n\n\n    parseChord(match) {\n        var note = match[1] || \" \";\n        var modifiers = match[2] || \"\";\n        var comment = match[3] || \"\";\n        if (comment)\n            modifiers += comment.substr(1, comment.length - 2).replace(\"XyQ\", \"   \");\n        var over = match[4] || \"\";\n        if (over[0] === '/')\n            over = over.substr(1);\n        var alternate = match[5] || null;\n        if (alternate) {\n            match = this.chordRegex.exec(alternate.substr(1, alternate.length - 2));\n            if (!match)\n                alternate = null;\n            else\n                alternate = this.parseChord(match);\n        }\n        // empty cell?\n        if (note === \" \" && !alternate && !over)\n            return null;\n        if (over) {\n            var offset = (over[1] === '#' || over[1] === 'b') ? 2 : 1;\n            over = new iRealChord(over.substr(0, offset), over.substr(offset), null, null);\n        }\n        else\n            over = null;\n        return new iRealChord(note, modifiers, over, alternate);\n    }\n\n    newToken(arr) {\n        var obj = new iRealToken;\n        arr.push(obj);\n        return obj;\n    }\n\n}\n\nclass iRealChord {\n    note: any;\n    modifiers: any;\n    over: any;\n    alternate: any;\n    constructor(note, modifiers, over, alternate) {\n        this.note = note;\n        this.modifiers = modifiers;\n        this.over = over;\n        this.alternate = alternate;\n    }\n}\n\nclass iRealToken {\n    chord: any;\n    spacer: number;\n    bars: string;\n    comments: any[];\n    token: any;\n    annots: any[];\n    constructor() {\n        this.annots = [];\n        this.comments = [];\n        this.bars = \"\";\n        this.spacer = 0;\n        this.chord = null;\n    }\n}","import C1 from \"./piano/C1.mp3\";\nimport Db1 from \"./piano/Db1.mp3\";\nimport D1 from \"./piano/D1.mp3\";\nimport Eb1 from \"./piano/Eb1.mp3\";\nimport E1 from \"./piano/E1.mp3\";\nimport F1 from \"./piano/F1.mp3\";\nimport Gb1 from \"./piano/Gb1.mp3\";\nimport G1 from \"./piano/G1.mp3\";\nimport Ab1 from \"./piano/Ab1.mp3\";\nimport A1 from \"./piano/A1.mp3\";\nimport Bb1 from \"./piano/Bb1.mp3\";\nimport B1 from \"./piano/B1.mp3\";\nimport C2 from \"./piano/C2.mp3\";\nimport Db2 from \"./piano/Db2.mp3\";\nimport D2 from \"./piano/D2.mp3\";\nimport Eb2 from \"./piano/Eb2.mp3\";\nimport E2 from \"./piano/E2.mp3\";\nimport F2 from \"./piano/F2.mp3\";\nimport Gb2 from \"./piano/Gb2.mp3\";\nimport G2 from \"./piano/G2.mp3\";\nimport Ab2 from \"./piano/Ab2.mp3\";\nimport A2 from \"./piano/A2.mp3\";\nimport Bb2 from \"./piano/Bb2.mp3\";\nimport B2 from \"./piano/B2.mp3\";\nimport C3 from \"./piano/C3.mp3\";\nimport Db3 from \"./piano/Db3.mp3\";\nimport D3 from \"./piano/D3.mp3\";\nimport Eb3 from \"./piano/Eb3.mp3\";\nimport E3 from \"./piano/E3.mp3\";\nimport F3 from \"./piano/F3.mp3\";\nimport Gb3 from \"./piano/Gb3.mp3\";\nimport G3 from \"./piano/G3.mp3\";\nimport Ab3 from \"./piano/Ab3.mp3\";\nimport A3 from \"./piano/A3.mp3\";\nimport Bb3 from \"./piano/Bb3.mp3\";\nimport B3 from \"./piano/B3.mp3\";\nimport C4 from \"./piano/C4.mp3\";\nimport Db4 from \"./piano/Db4.mp3\";\nimport D4 from \"./piano/D4.mp3\";\nimport Eb4 from \"./piano/Eb4.mp3\";\nimport E4 from \"./piano/E4.mp3\";\nimport F4 from \"./piano/F4.mp3\";\nimport Gb4 from \"./piano/Gb4.mp3\";\nimport G4 from \"./piano/G4.mp3\";\nimport Ab4 from \"./piano/Ab4.mp3\";\nimport A4 from \"./piano/A4.mp3\";\nimport Bb4 from \"./piano/Bb4.mp3\";\nimport B4 from \"./piano/B4.mp3\";\nimport C5 from \"./piano/C5.mp3\";\nimport Db5 from \"./piano/Db5.mp3\";\nimport D5 from \"./piano/D5.mp3\";\nimport Eb5 from \"./piano/Eb5.mp3\";\nimport E5 from \"./piano/E5.mp3\";\nimport F5 from \"./piano/F5.mp3\";\nimport Gb5 from \"./piano/Gb5.mp3\";\nimport G5 from \"./piano/G5.mp3\";\nimport Ab5 from \"./piano/Ab5.mp3\";\nimport A5 from \"./piano/A5.mp3\";\nimport Bb5 from \"./piano/Bb5.mp3\";\nimport B5 from \"./piano/B5.mp3\";\nimport C6 from \"./piano/C6.mp3\";\nimport Db6 from \"./piano/Db6.mp3\";\nimport D6 from \"./piano/D6.mp3\";\nimport Eb6 from \"./piano/Eb6.mp3\";\nimport E6 from \"./piano/E6.mp3\";\nimport F6 from \"./piano/F6.mp3\";\nimport Gb6 from \"./piano/Gb6.mp3\";\nimport G6 from \"./piano/G6.mp3\";\nimport Ab6 from \"./piano/Ab6.mp3\";\nimport A6 from \"./piano/A6.mp3\";\nimport Bb6 from \"./piano/Bb6.mp3\";\nimport B6 from \"./piano/B6.mp3\";\nimport C7 from \"./piano/C7.mp3\";\nimport Db7 from \"./piano/Db7.mp3\";\nimport D7 from \"./piano/D7.mp3\";\nimport Eb7 from \"./piano/Eb7.mp3\";\nimport E7 from \"./piano/E7.mp3\";\nimport F7 from \"./piano/F7.mp3\";\nimport Gb7 from \"./piano/Gb7.mp3\";\nimport G7 from \"./piano/G7.mp3\";\nimport Ab7 from \"./piano/Ab7.mp3\";\nimport A7 from \"./piano/A7.mp3\";\nimport Bb7 from \"./piano/Bb7.mp3\";\nimport B7 from \"./piano/B7.mp3\";\n\nexport const piano = [\n    C1,\n    Db1,\n    D1,\n    Eb1,\n    E1,\n    F1,\n    Gb1,\n    G1,\n    Ab1,\n    A1,\n    Bb1,\n    B1,\n    C2,\n    Db2,\n    D2,\n    Eb2,\n    E2,\n    F2,\n    Gb2,\n    G2,\n    Ab2,\n    A2,\n    Bb2,\n    B2,\n    C3,\n    Db3,\n    D3,\n    Eb3,\n    E3,\n    F3,\n    Gb3,\n    G3,\n    Ab3,\n    A3,\n    Bb3,\n    B3,\n    C4,\n    Db4,\n    D4,\n    Eb4,\n    E4,\n    F4,\n    Gb4,\n    G4,\n    Ab4,\n    A4,\n    Bb4,\n    B4,\n    C5,\n    Db5,\n    D5,\n    Eb5,\n    E5,\n    F5,\n    Gb5,\n    G5,\n    Ab5,\n    A5,\n    Bb5,\n    B5,\n    C6,\n    Db6,\n    D6,\n    Eb6,\n    E6,\n    F6,\n    Gb6,\n    G6,\n    Ab6,\n    A6,\n    Bb6,\n    B6,\n    C7,\n    Db7,\n    D7,\n    Eb7,\n    E7,\n    F7,\n    Gb7,\n    G7,\n    Ab7,\n    A7,\n    Bb7,\n    B7,\n];","\nimport k from './drummer/kick.wav';\nimport s from './drummer/snare.wav';\nimport h from './drummer/hihat.wav';\nimport r from './drummer/ride.wav';\nimport c from './drummer/crash.wav';\n\nexport const kick = k;\nexport const snare = s;\nexport const hihat = h;\nexport const ride = r;\nexport const crash = c;\nexport const drumset = [kick, snare, hihat, ride, crash];","'use strict';\n\n//unscrambling hints from https://github.com/ironss/accompaniser/blob/master/irealb_parser.lua\n//strings are broken up in 50 character segments. each segment undergoes character substitution addressed by obfusc50()\nexports.ireal = function(s){\n  let r = '', p;\n\n  while(s.length > 50){\n    p = s.substring(0, 50);\n    s = s.substring(50)\n    if(s.length < 2){\n      r = r + p;\n    }else{\n      r = r + obfusc50(p);\n    }\n  }\n  r = r + s;\n  return r;\n}\n\nfunction obfusc50 (s){\n  //the first 5 characters are switched with the last 5\n  let newString = s.split('');\n  for(let i = 0; i < 5; i++){\n    newString[49 - i] = s[i];\n    newString[i] = s[49 - i];\n  }\n  //characters 10-24 are also switched\n  for(let i = 10; i < 24; i++){\n    newString[49 - i] = s[i];\n    newString[i] = s[49 - i];\n  }\n  return newString.join('');\n}\n","'use strict';\n\n//regex:\n//  letters A-G and W (W is an invisible slash chord)\n//  {1} only one of the aforementioned letters\n//  followed by zero or more of these: + - ^ h o # b digit\n//  followed by an optional group (to catch slash chords)\n//    that starts with a slash\n//    followed by A-G\n//    followed by optional # or b\n\nconst chordRegex = /[A-GW]{1}[\\+\\-\\^\\dhob#suad]*(\\/[A-G][#b]?)?/g;\nconst musicPrefix = \"1r34LbKcu7\";\nconst unscramble = require('./unscramble');\n\nclass Music {\n  constructor(data){\n    const parts = data.split(musicPrefix);\n    this.raw = unscramble.ireal(parts[1]);\n    //TODO: read the time signature\n    this.timeSignature = 'T44';\n    const musicData = removeNonMusicalInfo(this.raw);\n    this.measures = getMeasures(musicData)\n  }\n}\nmodule.exports = Music;\n\nfunction getMeasures(data){\n  let measures = data.split(/\\||LZ|K|Z|\\{|\\}|\\[|\\]/g)//measures are delimited by |, LZ, {, } (repeat markers), [, ] (double barlines). Also splitting on K because Kcl seems to indicate a repeat of the previous measure. Z is the end of a song usually.\n\n  measures = fillSingleRepeats(measures);\n  measures = fillDoubleRepeats(measures);\n\n  measures = measures.map((x, index, array) => x.match(chordRegex))\n    .filter(x => !!x)  //filter out blank measures. if empty measures like N.C. are needed this has to be modified\n\n  measures = fillInvisibleSlashChords(measures);\n\n  return measures;\n}\n\nfunction removeNonMusicalInfo(data){\n  //remove all the non-musical information\n  data = removeFromString(data, /<.*?>/); //comments delimited by carets < ... >, non-greedy match. do this first as these may contain other symbols that we look for later on.\n  data = removeFromString(data, /\\*\\s*\\*/); //stars with empty space in between *  *\n  data = removeFromString(data, /\\*\\w/); //section markers *A, *B, *C\n  data = removeFromString(data, /T\\d+/); //time signatures T44, T34\n  data = removeFromString(data, /N\\d/); //repeat markers N1, N2, ...\n  data = removeFromString(data, /Y+/); //vertical spacers\n  data = removeFromString(data, 'XyQ'); //empty space\n  data = removeFromString(data, /[npUSQ]/); //n: N.C, p: pause slash, U: END, S: Segno, Q: Coda, \n  //s: small (consider using s when implementing chord duration)\n  return data;\n}\n\nfunction fillDoubleRepeats(measures){\n  const r = m => m.indexOf('r') >= 0;\n\n  //an 'r' becomes the two previous measures (drawn as a double angled bar)\n  let repeatMeasureIdx = measures.findIndex(r);\n  while(repeatMeasureIdx != -1){\n    measures.splice(repeatMeasureIdx, 1, measures[repeatMeasureIdx - 2], measures[repeatMeasureIdx - 1]);\n    repeatMeasureIdx = measures.findIndex(r);\n  }\n  return measures;\n}\n\nfunction fillSingleRepeats(measures){\n  //the repeat marker is Kcl but we've already split on K, so only cl is left over\n  //x appears in its own measure, (drawn as a single angled bar)\n  const xcl = m => m.indexOf('x') >= 0 || m.indexOf('cl') >= 0;\n\n  let repeatMeasureIdx = measures.findIndex(xcl);\n  while(repeatMeasureIdx != -1){\n    measures[repeatMeasureIdx] = measures[repeatMeasureIdx - 1];\n    repeatMeasureIdx = measures.findIndex(xcl);\n  }\n  return measures;\n}\n\nfunction fillInvisibleSlashChords(measures){\n  const W = m => m.some(c => c[0] === 'W');\n\n  let invisibleMeasureIdx = measures.findIndex(W);\n  while(invisibleMeasureIdx != -1){\n    const curMeasure = measures[invisibleMeasureIdx];\n    const invisibleChordIdx = curMeasure.findIndex(c => c[0] === 'W')\n\n    if(invisibleChordIdx > 0){\n      const previousChord = curMeasure[invisibleChordIdx - 1].split(\"/\")[0];\n      curMeasure[invisibleChordIdx] = curMeasure[invisibleChordIdx].replace('W', previousChord);\n    }else{\n      const previousMeasure = measures[invisibleMeasureIdx - 1];\n      const previousChord = previousMeasure[previousMeasure.length - 1].split(\"/\")[0];\n      curMeasure[invisibleChordIdx] = curMeasure[invisibleChordIdx].replace('W', previousChord);\n    }\n    invisibleMeasureIdx = measures.findIndex(W);\n  }\n  return measures;\n}\n\nfunction removeFromString(string, toRemove){\n  return string.split(toRemove).join('');\n}\n\n","'use strict';\n\nconst Music = require('./Music');\nconst musicPrefix = \"1r34LbKcu7\";\n\nclass Song {\n  constructor(data){\n    const parts = data.split(/=+/).filter(x => x != \"\"); //split on one or more equal signs, remove the blanks\n    let offset = 0\n    this.title = parts[0];\n    this.composer = parts[1];\n    this.style = parts[2];\n    this.key = parts[3];\n    this.transpose = null;\n    if(parts[4].indexOf(musicPrefix) !== 0){\n      offset = 1;\n      this.transpose = parseInt(parts[4]) || null;\n    }\n    this.music = new Music(parts[4 + offset]);\n    this.compStyle = parts[5 + offset] || null;\n    this.bpm = parseInt(parts[6 + offset]) || null;\n    this.repeats = parseInt(parts[7 + offset]) || null;\n  }\n}\n\nmodule.exports = Song;","'use strict';\n\nconst Song = require('./Song');\nconst regex = /.*?irealb:\\/\\/([^\"]*)/;\n\nclass Playlist {\n  constructor(data){\n    const percentEncoded = regex.exec(data);\n    const percentDecoded = decodeURIComponent(percentEncoded[1]);\n    const parts = percentDecoded.split(\"===\");  //songs are separated by ===\n    if(parts.length > 1) this.name = parts.pop();  //playlist name\n    this.songs = parts.map(x => new Song(x));\n  }\n}\n\nmodule.exports = Playlist;","'use strict';\n\nconst Playlist = require('./Playlist');\n\n//class hierarchy: Playlist has many Songs. Song has one Music.\n\nmodule.exports = Playlist;","import { getMidi } from \"../util\";\n\nexport class Instrument {\n    midiOffset = 0;\n    onPlay: (keys: number[]) => any;\n    onStop: (keys: number[]) => any;\n    ready: Promise<any>;\n    gain = 1;\n\n    context: any;\n    mix: any;\n    constructor({ context, gain, mix, onPlay, onStop, midiOffset }: any = {}) {\n        this.onPlay = onPlay;\n        this.midiOffset = midiOffset || this.midiOffset;\n        this.onStop = onStop;\n        this.gain = gain || this.gain;\n        this.init({ context, mix });\n    }\n\n    init({ context, mix }) {\n        if (!context && (!mix || !mix.context)) {\n            console.warn(`you should pass a context or a mix (gainNode) to a new Instrument. \n            You can also Call init with {context,mix} to setup the Instrument later`);\n            return;\n        }\n        this.context = context || mix.context;\n        this.mix = mix || this.context.destination;\n    }\n\n    playNotes(notes: string[], settings) {\n        this.playKeys(notes.map(note => getMidi(note, this.midiOffset)), settings);\n    }\n\n    playKeys(keys: number[], settings?) {\n        if (this.onPlay) {\n            return this.onPlay(keys);\n        }\n        // TODO: fire callbacks after keys.map((key,i)=>i*settings.interval)?\n    }\n}","import { Instrument } from './Instrument';\nimport { Note } from 'tonal';\nimport { adsr } from '../util';\n\nexport class Synthesizer extends Instrument {\n    duration = 200;\n    type = 'sine';\n    gain = 0.9;\n    attack = .05;\n    decay = .05;\n    sustain = .4;\n    release = .1;\n\n    constructor(props: any) {\n        super(props);\n        this.duration = props.duration || this.duration;\n        this.type = props.type || this.type;\n        this.gain = props.gain || this.gain;\n    }\n\n    init(context) {\n        super.init(context);\n    }\n\n    getVoice(type = 'sine', gain = 0, frequency = 440) {\n        const oscNode = this.context.createOscillator();\n        oscNode.type = type;\n        const gainNode = this.context.createGain();\n        oscNode.connect(gainNode);\n        gainNode.gain.value = typeof gain === 'number' ? gain : 0.8;\n        gainNode.connect(this.mix);\n        oscNode.frequency.value = frequency;\n        return { oscNode, gainNode };\n    }\n\n    lowestGain(a, b) {\n        return a.gain.gain.value < b.gain.gain.value ? -1 : 0;\n    }\n\n    playKeys(keys: number[], settings: any = {}) {\n        super.playKeys(keys, settings); // fires callback   \n        //const time = this.context.currentTime + settings.deadline / 1000;\n        const time = settings.deadline || this.context.currentTime;\n        const interval = settings.interval || 0;\n        keys.map((key, i) => {\n            const delay = i * interval;\n            const [attack, decay, sustain, release, duration, gain] =\n                [\n                    settings.attack || this.attack,\n                    settings.decay || this.decay,\n                    settings.sustain || this.sustain,\n                    settings.release || this.release,\n                    (settings.duration || this.duration) / 1000,\n                    (settings.gain || 1) * this.gain\n                ]\n            const voice = this.getVoice(this.type, 0, Note.freq(key));\n            adsr({ attack, decay, sustain, release, gain, duration, }, time + delay, voice.gainNode.gain);\n            voice.oscNode.start(settings.deadline + delay);\n        })\n    }\n}","import { Chord, Distance, Interval, Note } from 'tonal';\nimport { Synthesizer } from './instruments/Synthesizer';\n\nexport function randomNumber(n) {\n    return Math.floor(Math.random() * n)\n}\n\nexport function arraySum(array) {\n    return array.reduce((s, i) => s + i, 0);\n}\n\nexport function randomElement(array, weighted?) {\n    if (!weighted) {\n        return array[randomNumber(array.length)];\n    }\n    const r = randomNumber(arraySum(weighted)) + 1;\n    const total = weighted\n        .reduce((abs, w, i) => abs.concat(w + (abs.length ? abs[i - 1] : 0)), []);\n    return array[total.indexOf(total.find((s, i) => s >= r))];\n}\n\nexport function getTonalChord(chord) {\n    chord = chord\n        .replace('-', 'm')\n        .replace('^', 'M')\n        .replace('h7', 'm7b5')\n        .replace('h', 'dim');\n    /**\n     * Chords that dont work:\n     * slash cords are ignored\n     * 7b9b5 does not work\n     * \n     */\n    const tokens = Chord.tokenize(chord);\n    const s = tokens[1].split('/');\n    return tokens[0] + (s[0] || 'M');\n}\n\nexport function getMidi(note, offset) {\n    return Note.props(note).midi - offset;\n}\n\n/** Travels path along measures */\nexport function getPath(path, measures, traveled = []) {\n    if (!Array.isArray(measures[path[0]]) || path.length === 1) {\n        return measures[Math.min(path[0], measures.length - 1)];\n    }\n    return this.getPath(path.slice(1), measures[path[0]], traveled.concat(path[0]));\n}\n\nexport function resolveChords(pattern, measures, path, divisions = []) {\n    if (Array.isArray(pattern)) {\n        // division: array of children lengths down the path (to calculate fraction)\n        divisions = [].concat(divisions, [pattern.length]);\n        return pattern.map((p, i) => this.resolveChords(p, measures, path.concat([i]), divisions));\n    }\n    if (pattern === 0) {\n        return 0;\n    }\n    //const split = (pattern + '').split('.');\n    //const gain = parseFloat('0.' + split[1]); //digit(s) after .\n    //const fraction = (parseInt(split[0]) || 1) * divisions.reduce((f, d) => f / d, 1000); // fraction of one\n    const fraction = pattern * divisions.reduce((f, d) => f / d, 1000); // fraction of one\n    if (fraction === 0) {\n        console.warn('fraction is 0', pattern);\n    }\n    return { chord: this.getPath(path, measures), pattern, /* gain, */ path, divisions, fraction };\n}\n\nexport function hasOff(pattern, division = 3) {\n    return Array.isArray(pattern) && pattern.length === division && pattern[division - 1] !== 0;\n}\n\n// replaces offs on last beat with next chord + erases next one\nexport function offbeatReducer(settings) {\n    // TODO: find out why some offbeats sound sketchy\n    return (measures, bar, index) => {\n        const last = index > 0 ? measures[index - 1] : null;\n        if (last && this.hasOff(last[settings.cycle - 1], settings.division)) {\n            last[settings.cycle - 1][settings.division - 1] = bar[0];\n            bar[0] = 0;\n        }\n        return measures.concat([bar]);\n    };\n}\n\nexport function invertInterval(interval) {\n    if (Interval.semitones(interval) < 0) {\n        return Interval.invert(interval.slice(1));\n    }\n    return '-' + Interval.invert(interval);\n}\n\n// use Interval.ic?\nexport function smallestInterval(interval) {\n    interval = Interval.simplify(interval);\n    if (interval === '0A') {\n        interval = '1P'; // TODO: issue for tonal-interval (0A does not support invert and is not simple)\n    }\n    let inversion = this.invertInterval(interval);\n    if (Math.abs(Interval.semitones(inversion)) < Math.abs(Interval.semitones(interval))) {\n        return inversion;\n    }\n    return interval || '';\n}\n\nexport function minInterval(a, b, preferRightMovement) {\n    const semitones = [Math.abs(Interval.semitones(a)), Math.abs(Interval.semitones(b))];\n    if (semitones[0] === semitones[1]) {\n        if (preferRightMovement) {\n            return semitones[0] < 0 ? -1 : 1;\n        }\n        return semitones[0] > 0 ? -1 : 1;\n    }\n    return semitones[0] < semitones[1] ? -1 : 1;\n}\n\nexport function intervalMatrix(from, to) {\n    return to.map(note => from\n        .map(n => {\n            return Distance.interval(n, note)\n        })\n        .map(d => this.smallestInterval(d))\n        .map(i => i.slice(0, 2) === '--' ? i.slice(1) : i)\n    )\n}\n\nexport function randomSynth(mix, allowed = ['sine', 'triangle', 'square', 'sawtooth']) {\n    const gains = {\n        sine: 0.9,\n        triangle: 0.8,\n        square: 0.2,\n        sawtooth: 0.3\n    }\n    const wave = randomElement(allowed);\n    return new Synthesizer({ gain: gains[wave], type: wave, mix });\n}\n\nexport function adsr({ attack, decay, sustain, release, gain, duration }, time, param) {\n    // console.log('adsr', attack, decay, sustain, release, gain, duration, time);\n    param.linearRampToValueAtTime(gain, time + attack);\n    param.setTargetAtTime(sustain * gain, time + Math.min(attack + decay, duration), decay);\n    param.setTargetAtTime(0, time + Math.max(duration - attack - decay, attack + decay, duration), release);\n}\n","import { randomElement } from \"../util\";\n\nexport const swing = {\n    chords: ({ measure, settings }) => {\n        const off = () => randomElement([0, [0, 0, 2]], [6, 1]);\n        const r = Math.random() > 0.5 ? .6 : 0;\n        const t = `${settings.cycle}/${measure.length}`;\n        if (t === '4/1') {\n            return randomElement([\n                [[1, 0], [0, 0, 7], 0, 0],\n                [1, [0, 0, 2], 0, off()],\n                [[0, 0, 1], 0, 2, 0],\n                [[0, 0, 4], 0, 1, 0],\n                [2, 0, 0, 0],\n                [3, 0, 0, 0],\n                [1, 0, r, off()],\n                [[0, 0, 2], 0, r, 0],\n                [1.5, [0, 0, 2], 0, off()],\n            ]);//, [2, 1, 1]\n        }\n        if (t === '4/2') {\n            return randomElement([\n                [[1, 0], [0, 0, 7], 0, 0],\n                [1, [0, 0, 2], 0, 0],\n                [1, 0, 2, 0],\n                [2, 0, 1, 0],\n                [1, 0, .7, off()],\n                [[1, 0, 0], 0, .7, off()],\n                [[4, 0, 0], [0, 0, 2.8], 0, off()],\n            ],/*  [1, 2] */);\n        }\n\n        if (t === '4/3') {\n            return [1, [0, 0, 2], [0, 0, 4], 0];\n        }\n        if ('4/4') {\n            return randomElement([\n                [1, 1, 1, 1],\n                [[1, 0, 2], [0, 0, 2], 0, 1]\n            ]);\n        }\n    },\n    bass: () => randomElement([\n        [1, 1, 1, 1],\n    ]),\n    crash: ({ measures, index }) => {\n        const fill = index !== 0 && index % measures.length === 0;\n        if (fill) {\n            return [4, 0, 0, 0];\n        }\n        return [0, 0, 0, 0];\n    },\n    ride: ({ measures, index }) => {\n        return randomElement([\n            [.6, [.9, 0, 1], .6, [.9, 0, 1]],\n            [.6, [.4, 0, 1], .8, [0, 0, 1],],\n            [.6, .9, [.6, 0, 1], 1],\n            [.6, .9, .6, [.9, 0, 1]],\n        ], [3, 2, 1, 2])\n    },\n    hihat: () => [0, .8, 0, 1]\n};","import { randomElement } from \"../util\";\nexport const funk = {\n    chords: () => randomElement([\n        [[2, 0, 0, 1], 0, [0, .6], [0, 3.5, 0, 0]],\n        [[1, 0, 0, 5], 0, [0, .6], [1, .5, 0, 0]],\n        [[1, 0, 0, 5], 0, [0, .6], [.5, 0, 2, 0]],\n        [[1, 0, 0, 5], 0, [0, .6], [0, 2, 0, 1]],\n        [[3, 0, 0, 0], 0, 2, 0]\n    ]),\n    bass: () => randomElement(\n        [\n            [[2, 0, 0, 1], [0, 1], 1, [0, 1]],\n            [[2, 0, 0, 0], [0, 1, 0, 1], [0, 0, 1, 0], [0, 0, 0, 1]],\n        ]\n    ),\n    kick: (t) => [[[1, .7], 0, [0, 1], 0]],\n    snare: (t) => [0, 1, [0, .2, 0, 0], [1, 0, 0, .6]],\n    hihat: (t) => [[.5, .6], [.4, .7], [.3, .6], [.5, .7]]\n};","import * as jazz from '../lib';\nimport link from './playlists/1350.json';\n//import link from './playlists/zw.json';\nimport { RealParser } from '../src/RealParser';\nimport { piano } from './samples/piano';\n// import { harp } from './samples/harp';\nimport { drumset } from './samples/drumset';\nimport iRealReader from 'ireal-reader';\nimport { swing } from '../src/grooves/swing';\n// import { disco } from '../src/grooves/disco';\nimport { funk } from '../src/grooves/funk';\n\nconst context = new AudioContext();\nconst playlist = new iRealReader(decodeURI(link));\n\n// bass = new jazz.Synthesizer({ duration: 400, gain: gains[w1], type: w1, mix });\n\nconst keyboard = new jazz.Sampler({ samples: piano, midiOffset: 24, gain: 1, context });\n//const harpInstrument = new jazz.Sampler({ samples: harp, midiOffset: 24, gain: 1, context });\nconst drums = new jazz.Sampler({ samples: drumset, context, gain: 0.7, duration: 6000 });\n\nconst band = new jazz.Trio({ context, piano: keyboard, bass: keyboard, drums });\n\n\nfunction getStandard(playlist) {\n    console.log('playlist', playlist);\n    //const standard = jazz.util.randomElement(playlist.songs.filter(s => s.title.includes('Lone Jack (Page 1)'))); // TODO: fix\n    //const standard = jazz.util.randomElement(playlist.songs.filter(s => s.title.includes('Minor Strain'))); // TODO: fix\n    //const standard = jazz.util.randomElement(playlist.songs.filter(s => s.title.includes('El Cajon'))); // TODO: fix\n    //const standard = jazz.util.randomElement(playlist.songs.filter(s => s.title.includes('Mirror, Mirror'))); // TODO: fix\n    //const standard = jazz.util.randomElement(playlist.songs.filter(s => s.title.includes('Falling Grace')));\n    const standard = jazz.util.randomElement(playlist.songs);\n    const parser = new RealParser(standard.music.raw);\n    //console.log('tokens',parser.tokens);\n    standard.music.measures = parser.bars; // TODO: add Song that can be passed to comp\n    console.log('standard', standard, standard.music.measures);\n    console.log('sections', parser.sections);\n    return standard;\n}\n\n\nwindow.onload = function () {\n    // buttons\n    const playJazz = document.getElementById('jazz');\n    const playFunk = document.getElementById('funk');\n    const stop = document.getElementById('stop');\n    const slower = document.getElementById('slower');\n    const faster = document.getElementById('faster');\n    const next = document.getElementById('next');\n    const randomInstruments = document.getElementById('instruments');\n    let standard/*  = getStandard(); */\n\n    function play(groove: any = swing) {\n        console.log('groove', groove);\n        const bpm = 70 + Math.random() * 100;\n        //const bpm = 120;\n        console.log('tempo', bpm);\n        const cycle = 4;\n        band.comp(standard.music.measures, { metronome: true, cycle, bpm, groove/* , arpeggio: true */ })\n        /*band.comp(new Array(5).fill(1).reduce((a, c) => a.concat(['D-7', 'G7', 'C^7', 'C^7']), []),\n        { bpm, groove });*/\n    }\n\n    randomInstruments.addEventListener('click', () => {\n        const allowed = ['sine', 'triangle', 'square', 'sawtooth'];\n        band.pianist.instrument = jazz.util.randomSynth(band.mix, allowed);\n        band.bassist.instrument = jazz.util.randomSynth(band.mix, allowed);\n        console.log('pianist:', band.pianist.instrument.type);\n        console.log('bassist:', band.bassist.instrument.type);\n    });\n\n    playJazz.addEventListener('click', () => {\n        play(swing);\n    })\n    playFunk.addEventListener('click', () => {\n        play(funk)\n    })\n    stop.addEventListener('click', () => {\n        band.pulse.stop();\n    });\n    slower.addEventListener('click', () => {\n        band.pulse.changeTempo(band.pulse.props.bpm - 10);\n        console.log('tempo', band.pulse.props.bpm);\n    });\n    faster.addEventListener('click', () => {\n        band.pulse.changeTempo(band.pulse.props.bpm + 10);\n        console.log('tempo', band.pulse.props.bpm);\n    });\n\n    next.addEventListener('click', () => {\n        if (band.pulse) {\n            band.pulse.stop();\n        }\n        standard = getStandard(playlist);\n        setTimeout(() => play(), 500);\n    })\n}\n"]}